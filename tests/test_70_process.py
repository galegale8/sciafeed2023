
from datetime import datetime
from os.path import exists, join

from sciafeed import process, arpa19

from . import TEST_DATA_PATH


def test_parse_and_check(tmpdir):
    # --- arpa19 format ---
    filepath = join(TEST_DATA_PATH, 'arpa19', 'wrong_70002_201301010000_201401010100.dat')
    parameters_filepath = join(TEST_DATA_PATH, 'arpa19', 'arpa19_params.csv')
    limiting_params = {'3': ('1', '2')}
    err_msgs, data_parsed = process.parse_and_check(
        filepath, parameters_filepath, limiting_params)
    assert err_msgs == [
        (1, "The value of '1' is out of range [0.0, 1020.0]"),
        (2, "The value of '2' is out of range [0.0, 360.0]"),
        (3, "The value of '3' is out of range [-350.0, 450.0]"),
        (5, "The values of '3' and '2' are not consistent"),
        (6, "The values of '3' and '2' are not consistent"),
        (7, "The values of '3' and '2' are not consistent"),
        (10, "The values of '3' and '2' are not consistent"),
        (20, "The values of '3' and '2' are not consistent"),
    ]
    stat_props = {'cod_utente': '70002', 'lat': 43.876999}
    assert data_parsed == [
        [stat_props, datetime(2013, 1, 1, 0, 0), '1', 2000.0, False],
        [stat_props, datetime(2013, 1, 1, 0, 0), '2', 355.0, True],
        [stat_props, datetime(2013, 1, 1, 0, 0), '3', 68.0, True],
        [stat_props, datetime(2013, 1, 1, 0, 0), '4', None, False],
        [stat_props, datetime(2013, 1, 1, 0, 0), '5', None, False],
        [stat_props, datetime(2013, 1, 1, 0, 0), '6', None, False],
        [stat_props, datetime(2013, 1, 1, 0, 0), '7', None, False],
        [stat_props, datetime(2013, 1, 1, 0, 0), '8', None, False],
        [stat_props, datetime(2013, 1, 1, 0, 0), '9', 83.0, True],
        [stat_props, datetime(2013, 1, 1, 0, 0), '10', None, False],
        [stat_props, datetime(2013, 1, 1, 0, 0), '11', None, False],
        [stat_props, datetime(2013, 1, 1, 0, 0), '12', 10205.0, True],
        [stat_props, datetime(2013, 1, 1, 0, 0), '13', None, False],
        [stat_props, datetime(2013, 1, 1, 0, 0), '14', None, False],
        [stat_props, datetime(2013, 1, 1, 0, 0), '15', None, False],
        [stat_props, datetime(2013, 1, 1, 0, 0), '16', None, False],
        [stat_props, datetime(2013, 1, 1, 0, 0), '17', None, False],
        [stat_props, datetime(2013, 1, 1, 0, 0), '18', None, False],
        [stat_props, datetime(2013, 1, 1, 0, 0), '19', None, False],
        [stat_props, datetime(2013, 1, 1, 1, 0), '1', 6.0, True],
        [stat_props, datetime(2013, 1, 1, 1, 0), '2', 361.0, False],
        [stat_props, datetime(2013, 1, 1, 1, 0), '3', 65.0, True],
        [stat_props, datetime(2013, 1, 1, 1, 0), '4', None, False],
        [stat_props, datetime(2013, 1, 1, 1, 0), '5', None, False],
        [stat_props, datetime(2013, 1, 1, 1, 0), '6', None, False],
        [stat_props, datetime(2013, 1, 1, 1, 0), '7', None, False],
        [stat_props, datetime(2013, 1, 1, 1, 0), '8', None, False],
        [stat_props, datetime(2013, 1, 1, 1, 0), '9', 86.0, True],
        [stat_props, datetime(2013, 1, 1, 1, 0), '10', None, False],
        [stat_props, datetime(2013, 1, 1, 1, 0), '11', None, False],
        [stat_props, datetime(2013, 1, 1, 1, 0), '12', 10198.0, True],
        [stat_props, datetime(2013, 1, 1, 1, 0), '13', None, False],
        [stat_props, datetime(2013, 1, 1, 1, 0), '14', None, False],
        [stat_props, datetime(2013, 1, 1, 1, 0), '15', None, False],
        [stat_props, datetime(2013, 1, 1, 1, 0), '16', None, False],
        [stat_props, datetime(2013, 1, 1, 1, 0), '17', None, False],
        [stat_props, datetime(2013, 1, 1, 1, 0), '18', None, False],
        [stat_props, datetime(2013, 1, 1, 1, 0), '19', None, False],
        [stat_props, datetime(2013, 1, 1, 2, 0), '1', 3.0, True],
        [stat_props, datetime(2013, 1, 1, 2, 0), '2', 288.0, True],
        [stat_props, datetime(2013, 1, 1, 2, 0), '3', -351.0, False],
        [stat_props, datetime(2013, 1, 1, 2, 0), '4', None, False],
        [stat_props, datetime(2013, 1, 1, 2, 0), '5', None, False],
        [stat_props, datetime(2013, 1, 1, 2, 0), '6', None, False],
        [stat_props, datetime(2013, 1, 1, 2, 0), '7', None, False],
        [stat_props, datetime(2013, 1, 1, 2, 0), '8', None, False],
        [stat_props, datetime(2013, 1, 1, 2, 0), '9', 86.0, True],
        [stat_props, datetime(2013, 1, 1, 2, 0), '10', None, False],
        [stat_props, datetime(2013, 1, 1, 2, 0), '11', None, False],
        [stat_props, datetime(2013, 1, 1, 2, 0), '12', 10196.0, True],
        [stat_props, datetime(2013, 1, 1, 2, 0), '13', None, False],
        [stat_props, datetime(2013, 1, 1, 2, 0), '14', None, False],
        [stat_props, datetime(2013, 1, 1, 2, 0), '15', None, False],
        [stat_props, datetime(2013, 1, 1, 2, 0), '16', None, False],
        [stat_props, datetime(2013, 1, 1, 2, 0), '17', None, False],
        [stat_props, datetime(2013, 1, 1, 2, 0), '18', None, False],
        [stat_props, datetime(2013, 1, 1, 2, 0), '19', None, False],
        [stat_props, datetime(2013, 1, 1, 3, 0), '1', 11.0, True],
        [stat_props, datetime(2013, 1, 1, 3, 0), '2', 357.0, True],
        [stat_props, datetime(2013, 1, 1, 3, 0), '3', 63.0, True],
        [stat_props, datetime(2013, 1, 1, 3, 0), '4', None, False],
        [stat_props, datetime(2013, 1, 1, 3, 0), '5', None, False],
        [stat_props, datetime(2013, 1, 1, 3, 0), '6', None, False],
        [stat_props, datetime(2013, 1, 1, 3, 0), '7', None, False],
        [stat_props, datetime(2013, 1, 1, 3, 0), '8', None, False],
        [stat_props, datetime(2013, 1, 1, 3, 0), '9', 87.0, True],
        [stat_props, datetime(2013, 1, 1, 3, 0), '10', None, False],
        [stat_props, datetime(2013, 1, 1, 3, 0), '11', None, False],
        [stat_props, datetime(2013, 1, 1, 3, 0), '12', 10189.0, True],
        [stat_props, datetime(2013, 1, 1, 3, 0), '13', None, False],
        [stat_props, datetime(2013, 1, 1, 3, 0), '14', None, False],
        [stat_props, datetime(2013, 1, 1, 3, 0), '15', None, False],
        [stat_props, datetime(2013, 1, 1, 3, 0), '16', None, False],
        [stat_props, datetime(2013, 1, 1, 3, 0), '17', None, False],
        [stat_props, datetime(2013, 1, 1, 3, 0), '18', None, False],
        [stat_props, datetime(2013, 1, 1, 3, 0), '19', None, False],
        [stat_props, datetime(2013, 1, 1, 4, 0), '1', 9.0, True],
        [stat_props, datetime(2013, 1, 1, 4, 0), '2', 1.0, True],
        [stat_props, datetime(2013, 1, 1, 4, 0), '3', 64.0, False],
        [stat_props, datetime(2013, 1, 1, 4, 0), '4', None, False],
        [stat_props, datetime(2013, 1, 1, 4, 0), '5', None, False],
        [stat_props, datetime(2013, 1, 1, 4, 0), '6', None, False],
        [stat_props, datetime(2013, 1, 1, 4, 0), '7', None, False],
        [stat_props, datetime(2013, 1, 1, 4, 0), '8', None, False],
        [stat_props, datetime(2013, 1, 1, 4, 0), '9', 88.0, True],
        [stat_props, datetime(2013, 1, 1, 4, 0), '10', None, False],
        [stat_props, datetime(2013, 1, 1, 4, 0), '11', None, False],
        [stat_props, datetime(2013, 1, 1, 4, 0), '12', 10184.0, True],
        [stat_props, datetime(2013, 1, 1, 4, 0), '13', None, False],
        [stat_props, datetime(2013, 1, 1, 4, 0), '14', None, False],
        [stat_props, datetime(2013, 1, 1, 4, 0), '15', None, False],
        [stat_props, datetime(2013, 1, 1, 4, 0), '16', None, False],
        [stat_props, datetime(2013, 1, 1, 4, 0), '17', None, False],
        [stat_props, datetime(2013, 1, 1, 4, 0), '18', None, False],
        [stat_props, datetime(2013, 1, 1, 4, 0), '19', None, False],
        [stat_props, datetime(2013, 1, 1, 5, 0), '1', 30.0, True],
        [stat_props, datetime(2013, 1, 1, 5, 0), '2', 6.0, True],
        [stat_props, datetime(2013, 1, 1, 5, 0), '3', 67.0, False],
        [stat_props, datetime(2013, 1, 1, 5, 0), '4', None, False],
        [stat_props, datetime(2013, 1, 1, 5, 0), '5', None, False],
        [stat_props, datetime(2013, 1, 1, 5, 0), '6', None, False],
        [stat_props, datetime(2013, 1, 1, 5, 0), '7', None, False],
        [stat_props, datetime(2013, 1, 1, 5, 0), '8', None, False],
        [stat_props, datetime(2013, 1, 1, 5, 0), '9', 89.0, True],
        [stat_props, datetime(2013, 1, 1, 5, 0), '10', None, False],
        [stat_props, datetime(2013, 1, 1, 5, 0), '11', None, False],
        [stat_props, datetime(2013, 1, 1, 5, 0), '12', 10181.0, True],
        [stat_props, datetime(2013, 1, 1, 5, 0), '13', None, False],
        [stat_props, datetime(2013, 1, 1, 5, 0), '14', None, False],
        [stat_props, datetime(2013, 1, 1, 5, 0), '15', None, False],
        [stat_props, datetime(2013, 1, 1, 5, 0), '16', None, False],
        [stat_props, datetime(2013, 1, 1, 5, 0), '17', None, False],
        [stat_props, datetime(2013, 1, 1, 5, 0), '18', None, False],
        [stat_props, datetime(2013, 1, 1, 5, 0), '19', None, False],
        [stat_props, datetime(2013, 1, 1, 6, 0), '1', 31.0, True],
        [stat_props, datetime(2013, 1, 1, 6, 0), '2', 6.0, True],
        [stat_props, datetime(2013, 1, 1, 6, 0), '3', 65.0, False],
        [stat_props, datetime(2013, 1, 1, 6, 0), '4', None, False],
        [stat_props, datetime(2013, 1, 1, 6, 0), '5', None, False],
        [stat_props, datetime(2013, 1, 1, 6, 0), '6', None, False],
        [stat_props, datetime(2013, 1, 1, 6, 0), '7', None, False],
        [stat_props, datetime(2013, 1, 1, 6, 0), '8', None, False],
        [stat_props, datetime(2013, 1, 1, 6, 0), '9', 93.0, True],
        [stat_props, datetime(2013, 1, 1, 6, 0), '10', None, False],
        [stat_props, datetime(2013, 1, 1, 6, 0), '11', None, False],
        [stat_props, datetime(2013, 1, 1, 6, 0), '12', 10181.0, True],
        [stat_props, datetime(2013, 1, 1, 6, 0), '13', None, False],
        [stat_props, datetime(2013, 1, 1, 6, 0), '14', None, False],
        [stat_props, datetime(2013, 1, 1, 6, 0), '15', None, False],
        [stat_props, datetime(2013, 1, 1, 6, 0), '16', None, False],
        [stat_props, datetime(2013, 1, 1, 6, 0), '17', None, False],
        [stat_props, datetime(2013, 1, 1, 6, 0), '18', None, False],
        [stat_props, datetime(2013, 1, 1, 6, 0), '19', None, False],
        [stat_props, datetime(2013, 1, 1, 7, 0), '1', 20.0, True],
        [stat_props, datetime(2013, 1, 1, 7, 0), '2', 358.0, True],
        [stat_props, datetime(2013, 1, 1, 7, 0), '3', 65.0, True],
        [stat_props, datetime(2013, 1, 1, 7, 0), '4', None, False],
        [stat_props, datetime(2013, 1, 1, 7, 0), '5', None, False],
        [stat_props, datetime(2013, 1, 1, 7, 0), '6', None, False],
        [stat_props, datetime(2013, 1, 1, 7, 0), '7', None, False],
        [stat_props, datetime(2013, 1, 1, 7, 0), '8', None, False],
        [stat_props, datetime(2013, 1, 1, 7, 0), '9', 93.0, True],
        [stat_props, datetime(2013, 1, 1, 7, 0), '10', None, False],
        [stat_props, datetime(2013, 1, 1, 7, 0), '11', None, False],
        [stat_props, datetime(2013, 1, 1, 7, 0), '12', 10182.0, True],
        [stat_props, datetime(2013, 1, 1, 7, 0), '13', None, False],
        [stat_props, datetime(2013, 1, 1, 7, 0), '14', None, False],
        [stat_props, datetime(2013, 1, 1, 7, 0), '15', None, False],
        [stat_props, datetime(2013, 1, 1, 7, 0), '16', None, False],
        [stat_props, datetime(2013, 1, 1, 7, 0), '17', None, False],
        [stat_props, datetime(2013, 1, 1, 7, 0), '18', None, False],
        [stat_props, datetime(2013, 1, 1, 7, 0), '19', None, False],
        [stat_props, datetime(2013, 1, 1, 8, 0), '1', 5.0, True],
        [stat_props, datetime(2013, 1, 1, 8, 0), '2', 342.0, True],
        [stat_props, datetime(2013, 1, 1, 8, 0), '3', 66.0, True],
        [stat_props, datetime(2013, 1, 1, 8, 0), '4', None, False],
        [stat_props, datetime(2013, 1, 1, 8, 0), '5', None, False],
        [stat_props, datetime(2013, 1, 1, 8, 0), '6', None, False],
        [stat_props, datetime(2013, 1, 1, 8, 0), '7', None, False],
        [stat_props, datetime(2013, 1, 1, 8, 0), '8', None, False],
        [stat_props, datetime(2013, 1, 1, 8, 0), '9', 95.0, True],
        [stat_props, datetime(2013, 1, 1, 8, 0), '10', None, False],
        [stat_props, datetime(2013, 1, 1, 8, 0), '11', None, False],
        [stat_props, datetime(2013, 1, 1, 8, 0), '12', 10182.0, True],
        [stat_props, datetime(2013, 1, 1, 8, 0), '13', None, False],
        [stat_props, datetime(2013, 1, 1, 8, 0), '14', None, False],
        [stat_props, datetime(2013, 1, 1, 8, 0), '15', None, False],
        [stat_props, datetime(2013, 1, 1, 8, 0), '16', None, False],
        [stat_props, datetime(2013, 1, 1, 8, 0), '17', None, False],
        [stat_props, datetime(2013, 1, 1, 8, 0), '18', None, False],
        [stat_props, datetime(2013, 1, 1, 8, 0), '19', None, False],
        [stat_props, datetime(2013, 1, 1, 9, 0), '1', 35.0, True],
        [stat_props, datetime(2013, 1, 1, 9, 0), '2', 12.0, True],
        [stat_props, datetime(2013, 1, 1, 9, 0), '3', 106.0, False],
        [stat_props, datetime(2013, 1, 1, 9, 0), '4', None, False],
        [stat_props, datetime(2013, 1, 1, 9, 0), '5', None, False],
        [stat_props, datetime(2013, 1, 1, 9, 0), '6', None, False],
        [stat_props, datetime(2013, 1, 1, 9, 0), '7', None, False],
        [stat_props, datetime(2013, 1, 1, 9, 0), '8', None, False],
        [stat_props, datetime(2013, 1, 1, 9, 0), '9', 88.0, True],
        [stat_props, datetime(2013, 1, 1, 9, 0), '10', None, False],
        [stat_props, datetime(2013, 1, 1, 9, 0), '11', None, False],
        [stat_props, datetime(2013, 1, 1, 9, 0), '12', 10179.0, True],
        [stat_props, datetime(2013, 1, 1, 9, 0), '13', None, False],
        [stat_props, datetime(2013, 1, 1, 9, 0), '14', None, False],
        [stat_props, datetime(2013, 1, 1, 9, 0), '15', None, False],
        [stat_props, datetime(2013, 1, 1, 9, 0), '16', None, False],
        [stat_props, datetime(2013, 1, 1, 9, 0), '17', None, False],
        [stat_props, datetime(2013, 1, 1, 9, 0), '18', None, False],
        [stat_props, datetime(2013, 1, 1, 9, 0), '19', None, False],
        [stat_props, datetime(2013, 1, 1, 10, 0), '1', 13.0, True],
        [stat_props, datetime(2013, 1, 1, 10, 0), '2', 154.0, True],
        [stat_props, datetime(2013, 1, 1, 10, 0), '3', 121.0, True],
        [stat_props, datetime(2013, 1, 1, 10, 0), '4', None, False],
        [stat_props, datetime(2013, 1, 1, 10, 0), '5', None, False],
        [stat_props, datetime(2013, 1, 1, 10, 0), '6', None, False],
        [stat_props, datetime(2013, 1, 1, 10, 0), '7', None, False],
        [stat_props, datetime(2013, 1, 1, 10, 0), '8', None, False],
        [stat_props, datetime(2013, 1, 1, 10, 0), '9', 72.0, True],
        [stat_props, datetime(2013, 1, 1, 10, 0), '10', None, False],
        [stat_props, datetime(2013, 1, 1, 10, 0), '11', None, False],
        [stat_props, datetime(2013, 1, 1, 10, 0), '12', 10182.0, True],
        [stat_props, datetime(2013, 1, 1, 10, 0), '13', None, False],
        [stat_props, datetime(2013, 1, 1, 10, 0), '14', None, False],
        [stat_props, datetime(2013, 1, 1, 10, 0), '15', None, False],
        [stat_props, datetime(2013, 1, 1, 10, 0), '16', None, False],
        [stat_props, datetime(2013, 1, 1, 10, 0), '17', None, False],
        [stat_props, datetime(2013, 1, 1, 10, 0), '18', None, False],
        [stat_props, datetime(2013, 1, 1, 10, 0), '19', None, False],
        [stat_props, datetime(2013, 1, 1, 11, 0), '1', 54.0, True],
        [stat_props, datetime(2013, 1, 1, 11, 0), '2', 218.0, True],
        [stat_props, datetime(2013, 1, 1, 11, 0), '3', 123.0, True],
        [stat_props, datetime(2013, 1, 1, 11, 0), '4', None, False],
        [stat_props, datetime(2013, 1, 1, 11, 0), '5', None, False],
        [stat_props, datetime(2013, 1, 1, 11, 0), '6', None, False],
        [stat_props, datetime(2013, 1, 1, 11, 0), '7', None, False],
        [stat_props, datetime(2013, 1, 1, 11, 0), '8', None, False],
        [stat_props, datetime(2013, 1, 1, 11, 0), '9', 69.0, True],
        [stat_props, datetime(2013, 1, 1, 11, 0), '10', None, False],
        [stat_props, datetime(2013, 1, 1, 11, 0), '11', None, False],
        [stat_props, datetime(2013, 1, 1, 11, 0), '12', 10177.0, True],
        [stat_props, datetime(2013, 1, 1, 11, 0), '13', None, False],
        [stat_props, datetime(2013, 1, 1, 11, 0), '14', None, False],
        [stat_props, datetime(2013, 1, 1, 11, 0), '15', None, False],
        [stat_props, datetime(2013, 1, 1, 11, 0), '16', None, False],
        [stat_props, datetime(2013, 1, 1, 11, 0), '17', None, False],
        [stat_props, datetime(2013, 1, 1, 11, 0), '18', None, False],
        [stat_props, datetime(2013, 1, 1, 11, 0), '19', None, False],
        [stat_props, datetime(2013, 1, 1, 12, 0), '1', 61.0, True],
        [stat_props, datetime(2013, 1, 1, 12, 0), '2', 225.0, True],
        [stat_props, datetime(2013, 1, 1, 12, 0), '3', 125.0, True],
        [stat_props, datetime(2013, 1, 1, 12, 0), '4', None, False],
        [stat_props, datetime(2013, 1, 1, 12, 0), '5', None, False],
        [stat_props, datetime(2013, 1, 1, 12, 0), '6', None, False],
        [stat_props, datetime(2013, 1, 1, 12, 0), '7', None, False],
        [stat_props, datetime(2013, 1, 1, 12, 0), '8', None, False],
        [stat_props, datetime(2013, 1, 1, 12, 0), '9', 73.0, True],
        [stat_props, datetime(2013, 1, 1, 12, 0), '10', None, False],
        [stat_props, datetime(2013, 1, 1, 12, 0), '11', None, False],
        [stat_props, datetime(2013, 1, 1, 12, 0), '12', 10167.0, True],
        [stat_props, datetime(2013, 1, 1, 12, 0), '13', None, False],
        [stat_props, datetime(2013, 1, 1, 12, 0), '14', None, False],
        [stat_props, datetime(2013, 1, 1, 12, 0), '15', None, False],
        [stat_props, datetime(2013, 1, 1, 12, 0), '16', None, False],
        [stat_props, datetime(2013, 1, 1, 12, 0), '17', None, False],
        [stat_props, datetime(2013, 1, 1, 12, 0), '18', None, False],
        [stat_props, datetime(2013, 1, 1, 12, 0), '19', None, False],
        [stat_props, datetime(2013, 1, 1, 13, 0), '1', 65.0, True],
        [stat_props, datetime(2013, 1, 1, 13, 0), '2', 226.0, True],
        [stat_props, datetime(2013, 1, 1, 13, 0), '3', 122.0, True],
        [stat_props, datetime(2013, 1, 1, 13, 0), '4', None, False],
        [stat_props, datetime(2013, 1, 1, 13, 0), '5', None, False],
        [stat_props, datetime(2013, 1, 1, 13, 0), '6', None, False],
        [stat_props, datetime(2013, 1, 1, 13, 0), '7', None, False],
        [stat_props, datetime(2013, 1, 1, 13, 0), '8', None, False],
        [stat_props, datetime(2013, 1, 1, 13, 0), '9', 74.0, True],
        [stat_props, datetime(2013, 1, 1, 13, 0), '10', None, False],
        [stat_props, datetime(2013, 1, 1, 13, 0), '11', None, False],
        [stat_props, datetime(2013, 1, 1, 13, 0), '12', 10162.0, True],
        [stat_props, datetime(2013, 1, 1, 13, 0), '13', None, False],
        [stat_props, datetime(2013, 1, 1, 13, 0), '14', None, False],
        [stat_props, datetime(2013, 1, 1, 13, 0), '15', None, False],
        [stat_props, datetime(2013, 1, 1, 13, 0), '16', None, False],
        [stat_props, datetime(2013, 1, 1, 13, 0), '17', None, False],
        [stat_props, datetime(2013, 1, 1, 13, 0), '18', None, False],
        [stat_props, datetime(2013, 1, 1, 13, 0), '19', None, False],
        [stat_props, datetime(2013, 1, 1, 14, 0), '1', 46.0, True],
        [stat_props, datetime(2013, 1, 1, 14, 0), '2', 221.0, True],
        [stat_props, datetime(2013, 1, 1, 14, 0), '3', 117.0, True],
        [stat_props, datetime(2013, 1, 1, 14, 0), '4', None, False],
        [stat_props, datetime(2013, 1, 1, 14, 0), '5', None, False],
        [stat_props, datetime(2013, 1, 1, 14, 0), '6', None, False],
        [stat_props, datetime(2013, 1, 1, 14, 0), '7', None, False],
        [stat_props, datetime(2013, 1, 1, 14, 0), '8', None, False],
        [stat_props, datetime(2013, 1, 1, 14, 0), '9', 78.0, True],
        [stat_props, datetime(2013, 1, 1, 14, 0), '10', None, False],
        [stat_props, datetime(2013, 1, 1, 14, 0), '11', None, False],
        [stat_props, datetime(2013, 1, 1, 14, 0), '12', 10161.0, True],
        [stat_props, datetime(2013, 1, 1, 14, 0), '13', None, False],
        [stat_props, datetime(2013, 1, 1, 14, 0), '14', None, False],
        [stat_props, datetime(2013, 1, 1, 14, 0), '15', None, False],
        [stat_props, datetime(2013, 1, 1, 14, 0), '16', None, False],
        [stat_props, datetime(2013, 1, 1, 14, 0), '17', None, False],
        [stat_props, datetime(2013, 1, 1, 14, 0), '18', None, False],
        [stat_props, datetime(2013, 1, 1, 14, 0), '19', None, False],
        [stat_props, datetime(2013, 1, 1, 15, 0), '1', 19.0, True],
        [stat_props, datetime(2013, 1, 1, 15, 0), '2', 233.0, True],
        [stat_props, datetime(2013, 1, 1, 15, 0), '3', 110.0, True],
        [stat_props, datetime(2013, 1, 1, 15, 0), '4', None, False],
        [stat_props, datetime(2013, 1, 1, 15, 0), '5', None, False],
        [stat_props, datetime(2013, 1, 1, 15, 0), '6', None, False],
        [stat_props, datetime(2013, 1, 1, 15, 0), '7', None, False],
        [stat_props, datetime(2013, 1, 1, 15, 0), '8', None, False],
        [stat_props, datetime(2013, 1, 1, 15, 0), '9', 82.0, True],
        [stat_props, datetime(2013, 1, 1, 15, 0), '10', None, False],
        [stat_props, datetime(2013, 1, 1, 15, 0), '11', None, False],
        [stat_props, datetime(2013, 1, 1, 15, 0), '12', 10161.0, True],
        [stat_props, datetime(2013, 1, 1, 15, 0), '13', None, False],
        [stat_props, datetime(2013, 1, 1, 15, 0), '14', None, False],
        [stat_props, datetime(2013, 1, 1, 15, 0), '15', None, False],
        [stat_props, datetime(2013, 1, 1, 15, 0), '16', None, False],
        [stat_props, datetime(2013, 1, 1, 15, 0), '17', None, False],
        [stat_props, datetime(2013, 1, 1, 15, 0), '18', None, False],
        [stat_props, datetime(2013, 1, 1, 15, 0), '19', None, False],
        [stat_props, datetime(2013, 1, 1, 16, 0), '1', 28.0, True],
        [stat_props, datetime(2013, 1, 1, 16, 0), '2', 355.0, True],
        [stat_props, datetime(2013, 1, 1, 16, 0), '3', 100.0, True],
        [stat_props, datetime(2013, 1, 1, 16, 0), '4', None, False],
        [stat_props, datetime(2013, 1, 1, 16, 0), '5', None, False],
        [stat_props, datetime(2013, 1, 1, 16, 0), '6', None, False],
        [stat_props, datetime(2013, 1, 1, 16, 0), '7', None, False],
        [stat_props, datetime(2013, 1, 1, 16, 0), '8', None, False],
        [stat_props, datetime(2013, 1, 1, 16, 0), '9', 96.0, True],
        [stat_props, datetime(2013, 1, 1, 16, 0), '10', None, False],
        [stat_props, datetime(2013, 1, 1, 16, 0), '11', None, False],
        [stat_props, datetime(2013, 1, 1, 16, 0), '12', 10158.0, True],
        [stat_props, datetime(2013, 1, 1, 16, 0), '13', None, False],
        [stat_props, datetime(2013, 1, 1, 16, 0), '14', None, False],
        [stat_props, datetime(2013, 1, 1, 16, 0), '15', None, False],
        [stat_props, datetime(2013, 1, 1, 16, 0), '16', None, False],
        [stat_props, datetime(2013, 1, 1, 16, 0), '17', None, False],
        [stat_props, datetime(2013, 1, 1, 16, 0), '18', None, False],
        [stat_props, datetime(2013, 1, 1, 16, 0), '19', None, False],
        [stat_props, datetime(2013, 1, 1, 17, 0), '1', 24.0, True],
        [stat_props, datetime(2013, 1, 1, 17, 0), '2', 345.0, True],
        [stat_props, datetime(2013, 1, 1, 17, 0), '3', 99.0, True],
        [stat_props, datetime(2013, 1, 1, 17, 0), '4', None, False],
        [stat_props, datetime(2013, 1, 1, 17, 0), '5', None, False],
        [stat_props, datetime(2013, 1, 1, 17, 0), '6', None, False],
        [stat_props, datetime(2013, 1, 1, 17, 0), '7', None, False],
        [stat_props, datetime(2013, 1, 1, 17, 0), '8', None, False],
        [stat_props, datetime(2013, 1, 1, 17, 0), '9', 96.0, True],
        [stat_props, datetime(2013, 1, 1, 17, 0), '10', None, False],
        [stat_props, datetime(2013, 1, 1, 17, 0), '11', None, False],
        [stat_props, datetime(2013, 1, 1, 17, 0), '12', 10156.0, True],
        [stat_props, datetime(2013, 1, 1, 17, 0), '13', None, False],
        [stat_props, datetime(2013, 1, 1, 17, 0), '14', None, False],
        [stat_props, datetime(2013, 1, 1, 17, 0), '15', None, False],
        [stat_props, datetime(2013, 1, 1, 17, 0), '16', None, False],
        [stat_props, datetime(2013, 1, 1, 17, 0), '17', None, False],
        [stat_props, datetime(2013, 1, 1, 17, 0), '18', None, False],
        [stat_props, datetime(2013, 1, 1, 17, 0), '19', None, False],
        [stat_props, datetime(2013, 1, 1, 18, 0), '1', 26.0, True],
        [stat_props, datetime(2013, 1, 1, 18, 0), '2', 357.0, True],
        [stat_props, datetime(2013, 1, 1, 18, 0), '3', 101.0, True],
        [stat_props, datetime(2013, 1, 1, 18, 0), '4', None, False],
        [stat_props, datetime(2013, 1, 1, 18, 0), '5', None, False],
        [stat_props, datetime(2013, 1, 1, 18, 0), '6', None, False],
        [stat_props, datetime(2013, 1, 1, 18, 0), '7', None, False],
        [stat_props, datetime(2013, 1, 1, 18, 0), '8', None, False],
        [stat_props, datetime(2013, 1, 1, 18, 0), '9', 97.0, True],
        [stat_props, datetime(2013, 1, 1, 18, 0), '10', None, False],
        [stat_props, datetime(2013, 1, 1, 18, 0), '11', None, False],
        [stat_props, datetime(2013, 1, 1, 18, 0), '12', 10155.0, True],
        [stat_props, datetime(2013, 1, 1, 18, 0), '13', None, False],
        [stat_props, datetime(2013, 1, 1, 18, 0), '14', None, False],
        [stat_props, datetime(2013, 1, 1, 18, 0), '15', None, False],
        [stat_props, datetime(2013, 1, 1, 18, 0), '16', None, False],
        [stat_props, datetime(2013, 1, 1, 18, 0), '17', None, False],
        [stat_props, datetime(2013, 1, 1, 18, 0), '18', None, False],
        [stat_props, datetime(2013, 1, 1, 18, 0), '19', None, False],
        [stat_props, datetime(2013, 1, 1, 19, 0), '1', 26.0, True],
        [stat_props, datetime(2013, 1, 1, 19, 0), '2', 2.0, True],
        [stat_props, datetime(2013, 1, 1, 19, 0), '3', 99.0, False],
        [stat_props, datetime(2013, 1, 1, 19, 0), '4', None, False],
        [stat_props, datetime(2013, 1, 1, 19, 0), '5', None, False],
        [stat_props, datetime(2013, 1, 1, 19, 0), '6', None, False],
        [stat_props, datetime(2013, 1, 1, 19, 0), '7', None, False],
        [stat_props, datetime(2013, 1, 1, 19, 0), '8', None, False],
        [stat_props, datetime(2013, 1, 1, 19, 0), '9', 100.0, True],
        [stat_props, datetime(2013, 1, 1, 19, 0), '10', None, False],
        [stat_props, datetime(2013, 1, 1, 19, 0), '11', None, False],
        [stat_props, datetime(2013, 1, 1, 19, 0), '12', 10154.0, True],
        [stat_props, datetime(2013, 1, 1, 19, 0), '13', None, False],
        [stat_props, datetime(2013, 1, 1, 19, 0), '14', None, False],
        [stat_props, datetime(2013, 1, 1, 19, 0), '15', None, False],
        [stat_props, datetime(2013, 1, 1, 19, 0), '16', None, False],
        [stat_props, datetime(2013, 1, 1, 19, 0), '17', None, False],
        [stat_props, datetime(2013, 1, 1, 19, 0), '18', None, False],
        [stat_props, datetime(2013, 1, 1, 19, 0), '19', None, False]
    ]
    # global error
    filepath = str(tmpdir.join('report.txt'))
    err_msgs, _ = process.parse_and_check(
        filepath, parameters_filepath, limiting_params)
    assert err_msgs == [(0, 'the file has unknown format')]

    # --- arpa21 format ---
    filepath = join(TEST_DATA_PATH, 'arpa21', 'wrong_00202_201201010000_201301010100.dat')
    parameters_filepath = join(TEST_DATA_PATH, 'arpa21', 'arpa21_params.csv')
    limiting_params = {'9': ('10', '4')}
    err_msgs, data_parsed = process.parse_and_check(
        filepath, parameters_filepath, limiting_params)
    assert err_msgs == [
        (1, "The value of '3' is out of range [-350.0, 450.0]"),
        (1, "The values of '9' and '4' are not consistent"),
        (2, "The value of '4' is out of range [-400.0, 400.0]"),
        (3, "The value of '5' is out of range [-300.0, 500.0]"),
        (3, "The values of '9' and '4' are not consistent"),
        (4, "The values of '9' and '4' are not consistent"),
        (5, "The values of '9' and '4' are not consistent"),
        (6, "The values of '9' and '4' are not consistent"),
        (7, "The values of '9' and '4' are not consistent"),
        (8, "The values of '9' and '4' are not consistent"),
        (9, "The values of '9' and '4' are not consistent"),
        (20, "The values of '9' and '4' are not consistent")
    ]
    stat_props = {'cod_utente': '00202', 'lat': 37.33913}
    assert data_parsed == [
        [stat_props, datetime(2012, 1, 1, 0, 0), '1', None, False],
        [stat_props, datetime(2012, 1, 1, 0, 0), '2', 242.0, False],
        [stat_props, datetime(2012, 1, 1, 0, 0), '3', -570.0, False],
        [stat_props, datetime(2012, 1, 1, 0, 0), '4', 55.0, True],
        [stat_props, datetime(2012, 1, 1, 0, 0), '5', 60.0, True],
        [stat_props, datetime(2012, 1, 1, 0, 0), '6', None, False],
        [stat_props, datetime(2012, 1, 1, 0, 0), '7', None, False],
        [stat_props, datetime(2012, 1, 1, 0, 0), '8', None, False],
        [stat_props, datetime(2012, 1, 1, 0, 0), '9', 83.0, False],
        [stat_props, datetime(2012, 1, 1, 0, 0), '10', 80.0, True],
        [stat_props, datetime(2012, 1, 1, 0, 0), '11', 85.0, True],
        [stat_props, datetime(2012, 1, 1, 0, 0), '12', None, False],
        [stat_props, datetime(2012, 1, 1, 0, 0), '13', None, False],
        [stat_props, datetime(2012, 1, 1, 0, 0), '14', None, False],
        [stat_props, datetime(2012, 1, 1, 0, 0), '15', None, False],
        [stat_props, datetime(2012, 1, 1, 0, 0), '16', None, False],
        [stat_props, datetime(2012, 1, 1, 0, 0), '17', None, False],
        [stat_props, datetime(2012, 1, 1, 0, 0), '18', None, False],
        [stat_props, datetime(2012, 1, 1, 0, 0), '19', None, False],
        [stat_props, datetime(2012, 1, 1, 0, 0), '20', 0.0, True],
        [stat_props, datetime(2012, 1, 1, 0, 0), '21', None, False],
        [stat_props, datetime(2012, 1, 1, 1, 0), '1', None, False],
        [stat_props, datetime(2012, 1, 1, 1, 0), '2', 354.0, False],
        [stat_props, datetime(2012, 1, 1, 1, 0), '3', 56.0, True],
        [stat_props, datetime(2012, 1, 1, 1, 0), '4', 520.0, False],
        [stat_props, datetime(2012, 1, 1, 1, 0), '5', 59.0, True],
        [stat_props, datetime(2012, 1, 1, 1, 0), '6', None, False],
        [stat_props, datetime(2012, 1, 1, 1, 0), '7', None, False],
        [stat_props, datetime(2012, 1, 1, 1, 0), '8', None, False],
        [stat_props, datetime(2012, 1, 1, 1, 0), '9', 81.0, True],
        [stat_props, datetime(2012, 1, 1, 1, 0), '10', 79.0, True],
        [stat_props, datetime(2012, 1, 1, 1, 0), '11', 83.0, True],
        [stat_props, datetime(2012, 1, 1, 1, 0), '12', None, False],
        [stat_props, datetime(2012, 1, 1, 1, 0), '13', None, False],
        [stat_props, datetime(2012, 1, 1, 1, 0), '14', None, False],
        [stat_props, datetime(2012, 1, 1, 1, 0), '15', None, False],
        [stat_props, datetime(2012, 1, 1, 1, 0), '16', None, False],
        [stat_props, datetime(2012, 1, 1, 1, 0), '17', None, False],
        [stat_props, datetime(2012, 1, 1, 1, 0), '18', None, False],
        [stat_props, datetime(2012, 1, 1, 1, 0), '19', None, False],
        [stat_props, datetime(2012, 1, 1, 1, 0), '20', 0.0, True],
        [stat_props, datetime(2012, 1, 1, 1, 0), '21', None, False],
        [stat_props, datetime(2012, 1, 1, 2, 0), '1', None, False],
        [stat_props, datetime(2012, 1, 1, 2, 0), '2', 184.0, False],
        [stat_props, datetime(2012, 1, 1, 2, 0), '3', 56.0, True],
        [stat_props, datetime(2012, 1, 1, 2, 0), '4', 53.0, True],
        [stat_props, datetime(2012, 1, 1, 2, 0), '5', 580.0, False],
        [stat_props, datetime(2012, 1, 1, 2, 0), '6', None, False],
        [stat_props, datetime(2012, 1, 1, 2, 0), '7', None, False],
        [stat_props, datetime(2012, 1, 1, 2, 0), '8', None, False],
        [stat_props, datetime(2012, 1, 1, 2, 0), '9', 79.0, False],
        [stat_props, datetime(2012, 1, 1, 2, 0), '10', 79.0, True],
        [stat_props, datetime(2012, 1, 1, 2, 0), '11', 81.0, True],
        [stat_props, datetime(2012, 1, 1, 2, 0), '12', None, False],
        [stat_props, datetime(2012, 1, 1, 2, 0), '13', None, False],
        [stat_props, datetime(2012, 1, 1, 2, 0), '14', None, False],
        [stat_props, datetime(2012, 1, 1, 2, 0), '15', None, False],
        [stat_props, datetime(2012, 1, 1, 2, 0), '16', None, False],
        [stat_props, datetime(2012, 1, 1, 2, 0), '17', None, False],
        [stat_props, datetime(2012, 1, 1, 2, 0), '18', None, False],
        [stat_props, datetime(2012, 1, 1, 2, 0), '19', None, False],
        [stat_props, datetime(2012, 1, 1, 2, 0), '20', 0.0, True],
        [stat_props, datetime(2012, 1, 1, 2, 0), '21', None, False],
        [stat_props, datetime(2012, 1, 1, 3, 0), '1', None, False],
        [stat_props, datetime(2012, 1, 1, 3, 0), '2', 244.0, False],
        [stat_props, datetime(2012, 1, 1, 3, 0), '3', 50.0, True],
        [stat_props, datetime(2012, 1, 1, 3, 0), '4', 46.0, True],
        [stat_props, datetime(2012, 1, 1, 3, 0), '5', 57.0, True],
        [stat_props, datetime(2012, 1, 1, 3, 0), '6', None, False],
        [stat_props, datetime(2012, 1, 1, 3, 0), '7', None, False],
        [stat_props, datetime(2012, 1, 1, 3, 0), '8', None, False],
        [stat_props, datetime(2012, 1, 1, 3, 0), '9', 82.0, False],
        [stat_props, datetime(2012, 1, 1, 3, 0), '10', 79.0, True],
        [stat_props, datetime(2012, 1, 1, 3, 0), '11', 85.0, True],
        [stat_props, datetime(2012, 1, 1, 3, 0), '12', None, False],
        [stat_props, datetime(2012, 1, 1, 3, 0), '13', None, False],
        [stat_props, datetime(2012, 1, 1, 3, 0), '14', None, False],
        [stat_props, datetime(2012, 1, 1, 3, 0), '15', None, False],
        [stat_props, datetime(2012, 1, 1, 3, 0), '16', None, False],
        [stat_props, datetime(2012, 1, 1, 3, 0), '17', None, False],
        [stat_props, datetime(2012, 1, 1, 3, 0), '18', None, False],
        [stat_props, datetime(2012, 1, 1, 3, 0), '19', None, False],
        [stat_props, datetime(2012, 1, 1, 3, 0), '20', 0.0, True],
        [stat_props, datetime(2012, 1, 1, 3, 0), '21', None, False],
        [stat_props, datetime(2012, 1, 1, 4, 0), '1', None, False],
        [stat_props, datetime(2012, 1, 1, 4, 0), '2', 198.0, False],
        [stat_props, datetime(2012, 1, 1, 4, 0), '3', 44.0, True],
        [stat_props, datetime(2012, 1, 1, 4, 0), '4', 39.0, True],
        [stat_props, datetime(2012, 1, 1, 4, 0), '5', 50.0, True],
        [stat_props, datetime(2012, 1, 1, 4, 0), '6', None, False],
        [stat_props, datetime(2012, 1, 1, 4, 0), '7', None, False],
        [stat_props, datetime(2012, 1, 1, 4, 0), '8', None, False],
        [stat_props, datetime(2012, 1, 1, 4, 0), '9', 84.0, False],
        [stat_props, datetime(2012, 1, 1, 4, 0), '10', 82.0, True],
        [stat_props, datetime(2012, 1, 1, 4, 0), '11', 87.0, True],
        [stat_props, datetime(2012, 1, 1, 4, 0), '12', None, False],
        [stat_props, datetime(2012, 1, 1, 4, 0), '13', None, False],
        [stat_props, datetime(2012, 1, 1, 4, 0), '14', None, False],
        [stat_props, datetime(2012, 1, 1, 4, 0), '15', None, False],
        [stat_props, datetime(2012, 1, 1, 4, 0), '16', None, False],
        [stat_props, datetime(2012, 1, 1, 4, 0), '17', None, False],
        [stat_props, datetime(2012, 1, 1, 4, 0), '18', None, False],
        [stat_props, datetime(2012, 1, 1, 4, 0), '19', None, False],
        [stat_props, datetime(2012, 1, 1, 4, 0), '20', 0.0, True],
        [stat_props, datetime(2012, 1, 1, 4, 0), '21', None, False],
        [stat_props, datetime(2012, 1, 1, 5, 0), '1', None, False],
        [stat_props, datetime(2012, 1, 1, 5, 0), '2', 198.0, False],
        [stat_props, datetime(2012, 1, 1, 5, 0), '3', 46.0, True],
        [stat_props, datetime(2012, 1, 1, 5, 0), '4', 39.0, True],
        [stat_props, datetime(2012, 1, 1, 5, 0), '5', 49.0, True],
        [stat_props, datetime(2012, 1, 1, 5, 0), '6', None, False],
        [stat_props, datetime(2012, 1, 1, 5, 0), '7', None, False],
        [stat_props, datetime(2012, 1, 1, 5, 0), '8', None, False],
        [stat_props, datetime(2012, 1, 1, 5, 0), '9', 84.0, False],
        [stat_props, datetime(2012, 1, 1, 5, 0), '10', 83.0, True],
        [stat_props, datetime(2012, 1, 1, 5, 0), '11', 88.0, True],
        [stat_props, datetime(2012, 1, 1, 5, 0), '12', None, False],
        [stat_props, datetime(2012, 1, 1, 5, 0), '13', None, False],
        [stat_props, datetime(2012, 1, 1, 5, 0), '14', None, False],
        [stat_props, datetime(2012, 1, 1, 5, 0), '15', None, False],
        [stat_props, datetime(2012, 1, 1, 5, 0), '16', None, False],
        [stat_props, datetime(2012, 1, 1, 5, 0), '17', None, False],
        [stat_props, datetime(2012, 1, 1, 5, 0), '18', None, False],
        [stat_props, datetime(2012, 1, 1, 5, 0), '19', None, False],
        [stat_props, datetime(2012, 1, 1, 5, 0), '20', 0.0, True],
        [stat_props, datetime(2012, 1, 1, 5, 0), '21', None, False],
        [stat_props, datetime(2012, 1, 1, 6, 0), '1', None, False],
        [stat_props, datetime(2012, 1, 1, 6, 0), '2', 276.0, False],
        [stat_props, datetime(2012, 1, 1, 6, 0), '3', 50.0, True],
        [stat_props, datetime(2012, 1, 1, 6, 0), '4', 44.0, True],
        [stat_props, datetime(2012, 1, 1, 6, 0), '5', 59.0, True],
        [stat_props, datetime(2012, 1, 1, 6, 0), '6', None, False],
        [stat_props, datetime(2012, 1, 1, 6, 0), '7', None, False],
        [stat_props, datetime(2012, 1, 1, 6, 0), '8', None, False],
        [stat_props, datetime(2012, 1, 1, 6, 0), '9', 84.0, False],
        [stat_props, datetime(2012, 1, 1, 6, 0), '10', 82.0, True],
        [stat_props, datetime(2012, 1, 1, 6, 0), '11', 86.0, True],
        [stat_props, datetime(2012, 1, 1, 6, 0), '12', None, False],
        [stat_props, datetime(2012, 1, 1, 6, 0), '13', None, False],
        [stat_props, datetime(2012, 1, 1, 6, 0), '14', None, False],
        [stat_props, datetime(2012, 1, 1, 6, 0), '15', None, False],
        [stat_props, datetime(2012, 1, 1, 6, 0), '16', None, False],
        [stat_props, datetime(2012, 1, 1, 6, 0), '17', None, False],
        [stat_props, datetime(2012, 1, 1, 6, 0), '18', None, False],
        [stat_props, datetime(2012, 1, 1, 6, 0), '19', None, False],
        [stat_props, datetime(2012, 1, 1, 6, 0), '20', 0.0, True],
        [stat_props, datetime(2012, 1, 1, 6, 0), '21', None, False],
        [stat_props, datetime(2012, 1, 1, 7, 0), '1', None, False],
        [stat_props, datetime(2012, 1, 1, 7, 0), '2', 133.0, False],
        [stat_props, datetime(2012, 1, 1, 7, 0), '3', 59.0, True],
        [stat_props, datetime(2012, 1, 1, 7, 0), '4', 58.0, True],
        [stat_props, datetime(2012, 1, 1, 7, 0), '5', 62.0, True],
        [stat_props, datetime(2012, 1, 1, 7, 0), '6', None, False],
        [stat_props, datetime(2012, 1, 1, 7, 0), '7', None, False],
        [stat_props, datetime(2012, 1, 1, 7, 0), '8', None, False],
        [stat_props, datetime(2012, 1, 1, 7, 0), '9', 83.0, False],
        [stat_props, datetime(2012, 1, 1, 7, 0), '10', 83.0, True],
        [stat_props, datetime(2012, 1, 1, 7, 0), '11', 85.0, True],
        [stat_props, datetime(2012, 1, 1, 7, 0), '12', None, False],
        [stat_props, datetime(2012, 1, 1, 7, 0), '13', None, False],
        [stat_props, datetime(2012, 1, 1, 7, 0), '14', None, False],
        [stat_props, datetime(2012, 1, 1, 7, 0), '15', None, False],
        [stat_props, datetime(2012, 1, 1, 7, 0), '16', None, False],
        [stat_props, datetime(2012, 1, 1, 7, 0), '17', None, False],
        [stat_props, datetime(2012, 1, 1, 7, 0), '18', None, False],
        [stat_props, datetime(2012, 1, 1, 7, 0), '19', None, False],
        [stat_props, datetime(2012, 1, 1, 7, 0), '20', 0.0, True],
        [stat_props, datetime(2012, 1, 1, 7, 0), '21', None, False],
        [stat_props, datetime(2012, 1, 1, 8, 0), '1', None, False],
        [stat_props, datetime(2012, 1, 1, 8, 0), '2', 200.0, False],
        [stat_props, datetime(2012, 1, 1, 8, 0), '3', 72.0, True],
        [stat_props, datetime(2012, 1, 1, 8, 0), '4', 62.0, True],
        [stat_props, datetime(2012, 1, 1, 8, 0), '5', 85.0, True],
        [stat_props, datetime(2012, 1, 1, 8, 0), '6', None, False],
        [stat_props, datetime(2012, 1, 1, 8, 0), '7', None, False],
        [stat_props, datetime(2012, 1, 1, 8, 0), '8', None, False],
        [stat_props, datetime(2012, 1, 1, 8, 0), '9', 82.0, False],
        [stat_props, datetime(2012, 1, 1, 8, 0), '10', 80.0, True],
        [stat_props, datetime(2012, 1, 1, 8, 0), '11', 85.0, True],
        [stat_props, datetime(2012, 1, 1, 8, 0), '12', None, False],
        [stat_props, datetime(2012, 1, 1, 8, 0), '13', None, False],
        [stat_props, datetime(2012, 1, 1, 8, 0), '14', None, False],
        [stat_props, datetime(2012, 1, 1, 8, 0), '15', None, False],
        [stat_props, datetime(2012, 1, 1, 8, 0), '16', None, False],
        [stat_props, datetime(2012, 1, 1, 8, 0), '17', None, False],
        [stat_props, datetime(2012, 1, 1, 8, 0), '18', None, False],
        [stat_props, datetime(2012, 1, 1, 8, 0), '19', None, False],
        [stat_props, datetime(2012, 1, 1, 8, 0), '20', 0.0, True],
        [stat_props, datetime(2012, 1, 1, 8, 0), '21', None, False],
        [stat_props, datetime(2012, 1, 1, 9, 0), '1', None, False],
        [stat_props, datetime(2012, 1, 1, 9, 0), '2', 160.0, False],
        [stat_props, datetime(2012, 1, 1, 9, 0), '3', 93.0, True],
        [stat_props, datetime(2012, 1, 1, 9, 0), '4', 83.0, True],
        [stat_props, datetime(2012, 1, 1, 9, 0), '5', 111.0, True],
        [stat_props, datetime(2012, 1, 1, 9, 0), '6', None, False],
        [stat_props, datetime(2012, 1, 1, 9, 0), '7', None, False],
        [stat_props, datetime(2012, 1, 1, 9, 0), '8', None, False],
        [stat_props, datetime(2012, 1, 1, 9, 0), '9', 80.0, True],
        [stat_props, datetime(2012, 1, 1, 9, 0), '10', 73.0, True],
        [stat_props, datetime(2012, 1, 1, 9, 0), '11', 86.0, True],
        [stat_props, datetime(2012, 1, 1, 9, 0), '12', None, False],
        [stat_props, datetime(2012, 1, 1, 9, 0), '13', None, False],
        [stat_props, datetime(2012, 1, 1, 9, 0), '14', None, False],
        [stat_props, datetime(2012, 1, 1, 9, 0), '15', None, False],
        [stat_props, datetime(2012, 1, 1, 9, 0), '16', None, False],
        [stat_props, datetime(2012, 1, 1, 9, 0), '17', None, False],
        [stat_props, datetime(2012, 1, 1, 9, 0), '18', None, False],
        [stat_props, datetime(2012, 1, 1, 9, 0), '19', None, False],
        [stat_props, datetime(2012, 1, 1, 9, 0), '20', 0.0, True],
        [stat_props, datetime(2012, 1, 1, 9, 0), '21', None, False],
        [stat_props, datetime(2012, 1, 1, 10, 0), '1', None, False],
        [stat_props, datetime(2012, 1, 1, 10, 0), '2', 92.0, False],
        [stat_props, datetime(2012, 1, 1, 10, 0), '3', 122.0, True],
        [stat_props, datetime(2012, 1, 1, 10, 0), '4', 111.0, True],
        [stat_props, datetime(2012, 1, 1, 10, 0), '5', 140.0, True],
        [stat_props, datetime(2012, 1, 1, 10, 0), '6', None, False],
        [stat_props, datetime(2012, 1, 1, 10, 0), '7', None, False],
        [stat_props, datetime(2012, 1, 1, 10, 0), '8', None, False],
        [stat_props, datetime(2012, 1, 1, 10, 0), '9', 73.0, True],
        [stat_props, datetime(2012, 1, 1, 10, 0), '10', 67.0, True],
        [stat_props, datetime(2012, 1, 1, 10, 0), '11', 77.0, True],
        [stat_props, datetime(2012, 1, 1, 10, 0), '12', None, False],
        [stat_props, datetime(2012, 1, 1, 10, 0), '13', None, False],
        [stat_props, datetime(2012, 1, 1, 10, 0), '14', None, False],
        [stat_props, datetime(2012, 1, 1, 10, 0), '15', None, False],
        [stat_props, datetime(2012, 1, 1, 10, 0), '16', None, False],
        [stat_props, datetime(2012, 1, 1, 10, 0), '17', None, False],
        [stat_props, datetime(2012, 1, 1, 10, 0), '18', None, False],
        [stat_props, datetime(2012, 1, 1, 10, 0), '19', None, False],
        [stat_props, datetime(2012, 1, 1, 10, 0), '20', 0.0, True],
        [stat_props, datetime(2012, 1, 1, 10, 0), '21', None, False],
        [stat_props, datetime(2012, 1, 1, 11, 0), '1', None, False],
        [stat_props, datetime(2012, 1, 1, 11, 0), '2', 143.0, False],
        [stat_props, datetime(2012, 1, 1, 11, 0), '3', 135.0, True],
        [stat_props, datetime(2012, 1, 1, 11, 0), '4', 134.0, True],
        [stat_props, datetime(2012, 1, 1, 11, 0), '5', 140.0, True],
        [stat_props, datetime(2012, 1, 1, 11, 0), '6', None, False],
        [stat_props, datetime(2012, 1, 1, 11, 0), '7', None, False],
        [stat_props, datetime(2012, 1, 1, 11, 0), '8', None, False],
        [stat_props, datetime(2012, 1, 1, 11, 0), '9', 74.0, True],
        [stat_props, datetime(2012, 1, 1, 11, 0), '10', 68.0, True],
        [stat_props, datetime(2012, 1, 1, 11, 0), '11', 78.0, True],
        [stat_props, datetime(2012, 1, 1, 11, 0), '12', None, False],
        [stat_props, datetime(2012, 1, 1, 11, 0), '13', None, False],
        [stat_props, datetime(2012, 1, 1, 11, 0), '14', None, False],
        [stat_props, datetime(2012, 1, 1, 11, 0), '15', None, False],
        [stat_props, datetime(2012, 1, 1, 11, 0), '16', None, False],
        [stat_props, datetime(2012, 1, 1, 11, 0), '17', None, False],
        [stat_props, datetime(2012, 1, 1, 11, 0), '18', None, False],
        [stat_props, datetime(2012, 1, 1, 11, 0), '19', None, False],
        [stat_props, datetime(2012, 1, 1, 11, 0), '20', 0.0, True],
        [stat_props, datetime(2012, 1, 1, 11, 0), '21', None, False],
        [stat_props, datetime(2012, 1, 1, 12, 0), '1', None, False],
        [stat_props, datetime(2012, 1, 1, 12, 0), '2', 300.0, False],
        [stat_props, datetime(2012, 1, 1, 12, 0), '3', 139.0, True],
        [stat_props, datetime(2012, 1, 1, 12, 0), '4', 136.0, True],
        [stat_props, datetime(2012, 1, 1, 12, 0), '5', 144.0, True],
        [stat_props, datetime(2012, 1, 1, 12, 0), '6', None, False],
        [stat_props, datetime(2012, 1, 1, 12, 0), '7', None, False],
        [stat_props, datetime(2012, 1, 1, 12, 0), '8', None, False],
        [stat_props, datetime(2012, 1, 1, 12, 0), '9', 78.0, True],
        [stat_props, datetime(2012, 1, 1, 12, 0), '10', 76.0, True],
        [stat_props, datetime(2012, 1, 1, 12, 0), '11', 82.0, True],
        [stat_props, datetime(2012, 1, 1, 12, 0), '12', None, False],
        [stat_props, datetime(2012, 1, 1, 12, 0), '13', None, False],
        [stat_props, datetime(2012, 1, 1, 12, 0), '14', None, False],
        [stat_props, datetime(2012, 1, 1, 12, 0), '15', None, False],
        [stat_props, datetime(2012, 1, 1, 12, 0), '16', None, False],
        [stat_props, datetime(2012, 1, 1, 12, 0), '17', None, False],
        [stat_props, datetime(2012, 1, 1, 12, 0), '18', None, False],
        [stat_props, datetime(2012, 1, 1, 12, 0), '19', None, False],
        [stat_props, datetime(2012, 1, 1, 12, 0), '20', 0.0, True],
        [stat_props, datetime(2012, 1, 1, 12, 0), '21', None, False],
        [stat_props, datetime(2012, 1, 1, 13, 0), '1', None, False],
        [stat_props, datetime(2012, 1, 1, 13, 0), '2', 260.0, False],
        [stat_props, datetime(2012, 1, 1, 13, 0), '3', 140.0, True],
        [stat_props, datetime(2012, 1, 1, 13, 0), '4', 137.0, True],
        [stat_props, datetime(2012, 1, 1, 13, 0), '5', 145.0, True],
        [stat_props, datetime(2012, 1, 1, 13, 0), '6', None, False],
        [stat_props, datetime(2012, 1, 1, 13, 0), '7', None, False],
        [stat_props, datetime(2012, 1, 1, 13, 0), '8', None, False],
        [stat_props, datetime(2012, 1, 1, 13, 0), '9', 82.0, True],
        [stat_props, datetime(2012, 1, 1, 13, 0), '10', 80.0, True],
        [stat_props, datetime(2012, 1, 1, 13, 0), '11', 85.0, True],
        [stat_props, datetime(2012, 1, 1, 13, 0), '12', None, False],
        [stat_props, datetime(2012, 1, 1, 13, 0), '13', None, False],
        [stat_props, datetime(2012, 1, 1, 13, 0), '14', None, False],
        [stat_props, datetime(2012, 1, 1, 13, 0), '15', None, False],
        [stat_props, datetime(2012, 1, 1, 13, 0), '16', None, False],
        [stat_props, datetime(2012, 1, 1, 13, 0), '17', None, False],
        [stat_props, datetime(2012, 1, 1, 13, 0), '18', None, False],
        [stat_props, datetime(2012, 1, 1, 13, 0), '19', None, False],
        [stat_props, datetime(2012, 1, 1, 13, 0), '20', 0.0, True],
        [stat_props, datetime(2012, 1, 1, 13, 0), '21', None, False],
        [stat_props, datetime(2012, 1, 1, 14, 0), '1', None, False],
        [stat_props, datetime(2012, 1, 1, 14, 0), '2', 236.0, False],
        [stat_props, datetime(2012, 1, 1, 14, 0), '3', 143.0, True],
        [stat_props, datetime(2012, 1, 1, 14, 0), '4', 139.0, True],
        [stat_props, datetime(2012, 1, 1, 14, 0), '5', 147.0, True],
        [stat_props, datetime(2012, 1, 1, 14, 0), '6', None, False],
        [stat_props, datetime(2012, 1, 1, 14, 0), '7', None, False],
        [stat_props, datetime(2012, 1, 1, 14, 0), '8', None, False],
        [stat_props, datetime(2012, 1, 1, 14, 0), '9', 85.0, True],
        [stat_props, datetime(2012, 1, 1, 14, 0), '10', 84.0, True],
        [stat_props, datetime(2012, 1, 1, 14, 0), '11', 87.0, True],
        [stat_props, datetime(2012, 1, 1, 14, 0), '12', None, False],
        [stat_props, datetime(2012, 1, 1, 14, 0), '13', None, False],
        [stat_props, datetime(2012, 1, 1, 14, 0), '14', None, False],
        [stat_props, datetime(2012, 1, 1, 14, 0), '15', None, False],
        [stat_props, datetime(2012, 1, 1, 14, 0), '16', None, False],
        [stat_props, datetime(2012, 1, 1, 14, 0), '17', None, False],
        [stat_props, datetime(2012, 1, 1, 14, 0), '18', None, False],
        [stat_props, datetime(2012, 1, 1, 14, 0), '19', None, False],
        [stat_props, datetime(2012, 1, 1, 14, 0), '20', 0.0, True],
        [stat_props, datetime(2012, 1, 1, 14, 0), '21', None, False],
        [stat_props, datetime(2012, 1, 1, 15, 0), '1', None, False],
        [stat_props, datetime(2012, 1, 1, 15, 0), '2', 235.0, False],
        [stat_props, datetime(2012, 1, 1, 15, 0), '3', 141.0, True],
        [stat_props, datetime(2012, 1, 1, 15, 0), '4', 134.0, True],
        [stat_props, datetime(2012, 1, 1, 15, 0), '5', 146.0, True],
        [stat_props, datetime(2012, 1, 1, 15, 0), '6', None, False],
        [stat_props, datetime(2012, 1, 1, 15, 0), '7', None, False],
        [stat_props, datetime(2012, 1, 1, 15, 0), '8', None, False],
        [stat_props, datetime(2012, 1, 1, 15, 0), '9', 86.0, True],
        [stat_props, datetime(2012, 1, 1, 15, 0), '10', 85.0, True],
        [stat_props, datetime(2012, 1, 1, 15, 0), '11', 90.0, True],
        [stat_props, datetime(2012, 1, 1, 15, 0), '12', None, False],
        [stat_props, datetime(2012, 1, 1, 15, 0), '13', None, False],
        [stat_props, datetime(2012, 1, 1, 15, 0), '14', None, False],
        [stat_props, datetime(2012, 1, 1, 15, 0), '15', None, False],
        [stat_props, datetime(2012, 1, 1, 15, 0), '16', None, False],
        [stat_props, datetime(2012, 1, 1, 15, 0), '17', None, False],
        [stat_props, datetime(2012, 1, 1, 15, 0), '18', None, False],
        [stat_props, datetime(2012, 1, 1, 15, 0), '19', None, False],
        [stat_props, datetime(2012, 1, 1, 15, 0), '20', 0.0, True],
        [stat_props, datetime(2012, 1, 1, 15, 0), '21', None, False],
        [stat_props, datetime(2012, 1, 1, 16, 0), '1', None, False],
        [stat_props, datetime(2012, 1, 1, 16, 0), '2', 240.0, False],
        [stat_props, datetime(2012, 1, 1, 16, 0), '3', 128.0, True],
        [stat_props, datetime(2012, 1, 1, 16, 0), '4', 123.0, True],
        [stat_props, datetime(2012, 1, 1, 16, 0), '5', 133.0, True],
        [stat_props, datetime(2012, 1, 1, 16, 0), '6', None, False],
        [stat_props, datetime(2012, 1, 1, 16, 0), '7', None, False],
        [stat_props, datetime(2012, 1, 1, 16, 0), '8', None, False],
        [stat_props, datetime(2012, 1, 1, 16, 0), '9', 95.0, True],
        [stat_props, datetime(2012, 1, 1, 16, 0), '10', 91.0, True],
        [stat_props, datetime(2012, 1, 1, 16, 0), '11', 98.0, True],
        [stat_props, datetime(2012, 1, 1, 16, 0), '12', None, False],
        [stat_props, datetime(2012, 1, 1, 16, 0), '13', None, False],
        [stat_props, datetime(2012, 1, 1, 16, 0), '14', None, False],
        [stat_props, datetime(2012, 1, 1, 16, 0), '15', None, False],
        [stat_props, datetime(2012, 1, 1, 16, 0), '16', None, False],
        [stat_props, datetime(2012, 1, 1, 16, 0), '17', None, False],
        [stat_props, datetime(2012, 1, 1, 16, 0), '18', None, False],
        [stat_props, datetime(2012, 1, 1, 16, 0), '19', None, False],
        [stat_props, datetime(2012, 1, 1, 16, 0), '20', 0.0, True],
        [stat_props, datetime(2012, 1, 1, 16, 0), '21', None, False],
        [stat_props, datetime(2012, 1, 1, 17, 0), '1', None, False],
        [stat_props, datetime(2012, 1, 1, 17, 0), '2', 246.0, False],
        [stat_props, datetime(2012, 1, 1, 17, 0), '3', 119.0, True],
        [stat_props, datetime(2012, 1, 1, 17, 0), '4', 112.0, True],
        [stat_props, datetime(2012, 1, 1, 17, 0), '5', 123.0, True],
        [stat_props, datetime(2012, 1, 1, 17, 0), '6', None, False],
        [stat_props, datetime(2012, 1, 1, 17, 0), '7', None, False],
        [stat_props, datetime(2012, 1, 1, 17, 0), '8', None, False],
        [stat_props, datetime(2012, 1, 1, 17, 0), '9', 98.0, True],
        [stat_props, datetime(2012, 1, 1, 17, 0), '10', 97.0, True],
        [stat_props, datetime(2012, 1, 1, 17, 0), '11', 100.0, True],
        [stat_props, datetime(2012, 1, 1, 17, 0), '12', None, False],
        [stat_props, datetime(2012, 1, 1, 17, 0), '13', None, False],
        [stat_props, datetime(2012, 1, 1, 17, 0), '14', None, False],
        [stat_props, datetime(2012, 1, 1, 17, 0), '15', None, False],
        [stat_props, datetime(2012, 1, 1, 17, 0), '16', None, False],
        [stat_props, datetime(2012, 1, 1, 17, 0), '17', None, False],
        [stat_props, datetime(2012, 1, 1, 17, 0), '18', None, False],
        [stat_props, datetime(2012, 1, 1, 17, 0), '19', None, False],
        [stat_props, datetime(2012, 1, 1, 17, 0), '20', 0.0, True],
        [stat_props, datetime(2012, 1, 1, 17, 0), '21', None, False],
        [stat_props, datetime(2012, 1, 1, 18, 0), '1', None, False],
        [stat_props, datetime(2012, 1, 1, 18, 0), '2', 322.0, False],
        [stat_props, datetime(2012, 1, 1, 18, 0), '3', 110.0, True],
        [stat_props, datetime(2012, 1, 1, 18, 0), '4', 106.0, True],
        [stat_props, datetime(2012, 1, 1, 18, 0), '5', 113.0, True],
        [stat_props, datetime(2012, 1, 1, 18, 0), '6', None, False],
        [stat_props, datetime(2012, 1, 1, 18, 0), '7', None, False],
        [stat_props, datetime(2012, 1, 1, 18, 0), '8', None, False],
        [stat_props, datetime(2012, 1, 1, 18, 0), '9', 100.0, True],
        [stat_props, datetime(2012, 1, 1, 18, 0), '10', 100.0, True],
        [stat_props, datetime(2012, 1, 1, 18, 0), '11', 100.0, True],
        [stat_props, datetime(2012, 1, 1, 18, 0), '12', None, False],
        [stat_props, datetime(2012, 1, 1, 18, 0), '13', None, False],
        [stat_props, datetime(2012, 1, 1, 18, 0), '14', None, False],
        [stat_props, datetime(2012, 1, 1, 18, 0), '15', None, False],
        [stat_props, datetime(2012, 1, 1, 18, 0), '16', None, False],
        [stat_props, datetime(2012, 1, 1, 18, 0), '17', None, False],
        [stat_props, datetime(2012, 1, 1, 18, 0), '18', None, False],
        [stat_props, datetime(2012, 1, 1, 18, 0), '19', None, False],
        [stat_props, datetime(2012, 1, 1, 18, 0), '20', 0.0, True],
        [stat_props, datetime(2012, 1, 1, 18, 0), '21', None, False],
        [stat_props, datetime(2012, 1, 1, 19, 0), '1', None, False],
        [stat_props, datetime(2012, 1, 1, 19, 0), '2', 65.0, False],
        [stat_props, datetime(2012, 1, 1, 19, 0), '3', 99.0, True],
        [stat_props, datetime(2012, 1, 1, 19, 0), '4', 95.0, True],
        [stat_props, datetime(2012, 1, 1, 19, 0), '5', 106.0, True],
        [stat_props, datetime(2012, 1, 1, 19, 0), '6', None, False],
        [stat_props, datetime(2012, 1, 1, 19, 0), '7', None, False],
        [stat_props, datetime(2012, 1, 1, 19, 0), '8', None, False],
        [stat_props, datetime(2012, 1, 1, 19, 0), '9', 100.0, False],
        [stat_props, datetime(2012, 1, 1, 19, 0), '10', 100.0, True],
        [stat_props, datetime(2012, 1, 1, 19, 0), '11', 100.0, True],
        [stat_props, datetime(2012, 1, 1, 19, 0), '12', None, False],
        [stat_props, datetime(2012, 1, 1, 19, 0), '13', None, False],
        [stat_props, datetime(2012, 1, 1, 19, 0), '14', None, False],
        [stat_props, datetime(2012, 1, 1, 19, 0), '15', None, False],
        [stat_props, datetime(2012, 1, 1, 19, 0), '16', None, False],
        [stat_props, datetime(2012, 1, 1, 19, 0), '17', None, False],
        [stat_props, datetime(2012, 1, 1, 19, 0), '18', None, False],
        [stat_props, datetime(2012, 1, 1, 19, 0), '19', None, False],
        [stat_props, datetime(2012, 1, 1, 19, 0), '20', 0.0, True],
        [stat_props, datetime(2012, 1, 1, 19, 0), '21', None, False]
    ]
    # global error
    filepath = str(tmpdir.join('report.txt'))
    err_msgs, _ = process.parse_and_check(
        filepath, parameters_filepath, limiting_params)
    assert err_msgs == [(0, 'the file has unknown format')]

    # --- arpafvg format ---
    filepath = join(TEST_DATA_PATH, 'arpafvg', 'wrong_00001_2018010101_2019010101.dat')
    parameters_filepath = join(TEST_DATA_PATH, 'arpafvg', 'arpafvg_params.csv')
    limiting_params = {'PREC': ('Bagnatura_f', 'DD')}
    err_msgs, data_parsed = process.parse_and_check(
        filepath, parameters_filepath, limiting_params)
    stat_props = {'cod_utente': '00001', 'lat': 46.077222}
    assert err_msgs == [
        (1, 'The number of components in the row is wrong'),
        (3, 'duplication of rows with different data'),
        (4, 'the latitude changes'),
        (5, 'duplication of rows with different data'),
        (6, 'it is not strictly after the previous'),
        (7, 'the time is not coherent with the filename'),
        (2, "The values of 'PREC' and 'Bagnatura_f' are not consistent")]
    assert data_parsed == [
        [stat_props, datetime(2018, 1, 1, 2, 0), 'PREC', 0.0, False],
        [stat_props, datetime(2018, 1, 1, 2, 0), 'Tmedia', 3.1, True],
        [stat_props, datetime(2018, 1, 1, 2, 0), 'UR media', 85.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 0), 'Bagnatura_f', 59.0,
         True],
        [stat_props, datetime(2018, 1, 1, 2, 0), 'DD', 317.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 0), 'FF', 1.6, True],
        [stat_props, datetime(2018, 1, 1, 2, 0), 'Pstaz', 1001.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 0), 'RADSOL', 0.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 0), 'INSOL', 0.0, True]]
    # global error
    filepath = str(tmpdir.join('report.txt'))
    err_msgs, _ = process.parse_and_check(
        filepath, parameters_filepath, limiting_params)
    assert err_msgs == [(0, 'the file has unknown format')]

    # --- bolzano format ---
    parameters_filepath = join(TEST_DATA_PATH, 'bolzano', 'bolzano_params.csv')
    filepath = join(TEST_DATA_PATH, 'bolzano', 'MonteMaria.xls')
    station_props = {'cod_utente': '02500MS', 'desc': 'Marienberg - Monte Maria', 'height': '1310',
                     'utmx': '616288', 'utmy': '5173583'}
    expected_data = [
        [station_props, datetime(1981, 1, 1, 0, 0), 'Tmin', 3.0, True],
        [station_props, datetime(1981, 1, 1, 0, 0), 'Tmax', 9.0, True],
        [station_props, datetime(1981, 1, 1, 0, 0), 'PREC', 0.0, True],
        [station_props, datetime(1981, 1, 2, 0, 0), 'Tmin', -4.0, True],
        [station_props, datetime(1981, 1, 2, 0, 0), 'Tmax', 5.0, True],
        [station_props, datetime(1981, 1, 2, 0, 0), 'PREC', 0.4, True],
        [station_props, datetime(1981, 1, 3, 0, 0), 'Tmin', -4.0, True],
        [station_props, datetime(1981, 1, 3, 0, 0), 'Tmax', 5.0, True],
        [station_props, datetime(1981, 1, 3, 0, 0), 'PREC', 0.0, True],
        [station_props, datetime(1981, 1, 4, 0, 0), 'Tmin', 1.0, True],
        [station_props, datetime(1981, 1, 4, 0, 0), 'Tmax', 9.0, True],
        [station_props, datetime(1981, 1, 4, 0, 0), 'PREC', 14.5, True],
        [station_props, datetime(1981, 1, 5, 0, 0), 'Tmin', -8.0, True],
        [station_props, datetime(1981, 1, 5, 0, 0), 'Tmax', 3.0, True],
        [station_props, datetime(1981, 1, 5, 0, 0), 'PREC', 5.1, True],
        [station_props, datetime(1981, 1, 6, 0, 0), 'Tmin', -8.0, True],
        [station_props, datetime(1981, 1, 6, 0, 0), 'Tmax', -5.0, True],
        [station_props, datetime(1981, 1, 6, 0, 0), 'PREC', 1.0, True],
        [station_props, datetime(1981, 1, 7, 0, 0), 'Tmin', -9.0, True],
        [station_props, datetime(1981, 1, 7, 0, 0), 'Tmax', -5.0, True],
        [station_props, datetime(1981, 1, 7, 0, 0), 'PREC', 6.1, True],
        [station_props, datetime(1981, 1, 8, 0, 0), 'Tmin', -13.0, True],
        [station_props, datetime(1981, 1, 8, 0, 0), 'Tmax', -7.0, True],
        [station_props, datetime(1981, 1, 8, 0, 0), 'PREC', 0.0, True]
    ]
    err_msgs, parsed_data = process.parse_and_check(filepath, parameters_filepath)
    assert not err_msgs
    assert parsed_data == expected_data

    # with some errors
    limiting_params = {'Tmin': ('PREC', 'Tmax')}
    filepath = join(TEST_DATA_PATH, 'bolzano', 'wrong3.xls')
    err_msgs, parsed_data = process.parse_and_check(filepath, parameters_filepath,
                                                    limiting_params=limiting_params)
    assert err_msgs == [
        (14, 'the date format is wrong'),
        (15, 'the row contains values not numeric'),
        (18, 'the row is not strictly after the previous'),
        (22, 'the row is duplicated with different values'),
        (16, "The values of 'Tmin' and 'PREC' are not consistent"),
        (17, "The value of 'Tmax' is out of range [-30.0, 50.0]"),
        (17, "The values of 'Tmin' and 'PREC' are not consistent"),
        (19, "The values of 'Tmin' and 'PREC' are not consistent"),
        (20, "The values of 'Tmin' and 'PREC' are not consistent"),
        (21, "The values of 'Tmin' and 'PREC' are not consistent"),
        (23, "The values of 'Tmin' and 'PREC' are not consistent"),
        (24, "The value of 'PREC' is out of range [0.0, 989.0]")
    ]
    assert parsed_data == [
        [station_props, datetime(1981, 1, 3, 0, 0), 'Tmin', -4.0, False],
        [station_props, datetime(1981, 1, 3, 0, 0), 'Tmax', 5.0, True],
        [station_props, datetime(1981, 1, 3, 0, 0), 'PREC', 0.0, True],
        [station_props, datetime(1981, 1, 4, 0, 0), 'Tmin', 1.0, False],
        [station_props, datetime(1981, 1, 4, 0, 0), 'Tmax', 9999.0, False],
        [station_props, datetime(1981, 1, 4, 0, 0), 'PREC', 14.5, True],
        [station_props, datetime(1981, 1, 5, 0, 0), 'Tmin', -8.0, False],
        [station_props, datetime(1981, 1, 5, 0, 0), 'Tmax', 3.0, True],
        [station_props, datetime(1981, 1, 5, 0, 0), 'PREC', 5.1, True],
        [station_props, datetime(1981, 1, 5, 0, 0), 'Tmin', -8.0, False],
        [station_props, datetime(1981, 1, 5, 0, 0), 'Tmax', 3.0, True],
        [station_props, datetime(1981, 1, 5, 0, 0), 'PREC', 5.1, True],
        [station_props, datetime(1981, 1, 6, 0, 0), 'Tmin', -8.0, False],
        [station_props, datetime(1981, 1, 6, 0, 0), 'Tmax', -5.0, True],
        [station_props, datetime(1981, 1, 6, 0, 0), 'PREC', 1.0, True],
        [station_props, datetime(1981, 1, 7, 0, 0), 'Tmin', -9.0, False],
        [station_props, datetime(1981, 1, 7, 0, 0), 'Tmax', -5.0, True],
        [station_props, datetime(1981, 1, 7, 0, 0), 'PREC', 6.1, True],
        [station_props, datetime(1981, 1, 8, 0, 0), 'Tmin', -13.0, True],
        [station_props, datetime(1981, 1, 8, 0, 0), 'Tmax', -7.0, True],
        [station_props, datetime(1981, 1, 8, 0, 0), 'PREC', -3.0, False]
    ]
    # global error
    filepath = str(tmpdir.join('report.txt'))
    with open(filepath, 'w'):
        pass
    err_msgs, parsed_after_check = process.parse_and_check(
        filepath, parameters_filepath, limiting_params)
    assert err_msgs == [(0, 'the file has unknown format')]
    assert not parsed_after_check

    # --- NOAA format ---
    filepath = join(TEST_DATA_PATH, 'noaa', 'wrong2_160080-99999-2019.op')
    parameters_filepath = join(TEST_DATA_PATH, 'noaa', 'noaa_params.csv')
    limiting_params = {'Tmedia': ('Tmin', 'Tmax')}
    err_msgs, data_parsed = process.parse_and_check(
        filepath, parameters_filepath, limiting_params)
    assert err_msgs == [
        (2, 'the length of the row is not standard'),
        (3, 'the reference time for the row is not parsable'),
        (4, 'the precipitation flag is not parsable'),
        (5, 'The number of components in the row is wrong'),
        (6, 'The row contains not numeric values'),
        (10, 'duplication of rows with different data'),
        (12, 'it is not strictly after the previous')
    ]
    stat_props = {'cod_utente': '160080', 'wban': '99999'}
    expected_data_parsed = [
        [stat_props, datetime(2019, 1, 6, 0, 0), 'Tmedia', 29.3, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'DEWP', 23.3, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'P', None, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'STP', 857.8, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'VISIB', 7.9, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'FF', 7.5, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'MXSPD', 8.9, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'GUST', None, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'Tmax', 34.2, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'Tmin', 27.0, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'PREC', 0.0, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'SNDP', 4.7, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'Tmedia', 29.3, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'DEWP', 23.3, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'P', None, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'STP', 857.8, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'VISIB', 7.9, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'FF', 7.5, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'MXSPD', 8.9, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'GUST', None, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'Tmax', 34.2, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'Tmin', 27.0, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'PREC', 0.0, True],
        [stat_props, datetime(2019, 1, 6, 0, 0), 'SNDP', 4.7, True],
        [stat_props, datetime(2019, 1, 7, 0, 0), 'Tmedia', 27.8, True],
        [stat_props, datetime(2019, 1, 7, 0, 0), 'DEWP', 21.7, True],
        [stat_props, datetime(2019, 1, 7, 0, 0), 'P', None, True],
        [stat_props, datetime(2019, 1, 7, 0, 0), 'STP', 858.9, True],
        [stat_props, datetime(2019, 1, 7, 0, 0), 'VISIB', 7.4, True],
        [stat_props, datetime(2019, 1, 7, 0, 0), 'FF', 7.1, True],
        [stat_props, datetime(2019, 1, 7, 0, 0), 'MXSPD', 8.9, True],
        [stat_props, datetime(2019, 1, 7, 0, 0), 'GUST', None, True],
        [stat_props, datetime(2019, 1, 7, 0, 0), 'Tmax', 32.4, True],
        [stat_props, datetime(2019, 1, 7, 0, 0), 'Tmin', 23.0, True],
        [stat_props, datetime(2019, 1, 7, 0, 0), 'PREC', 0.0, True],
        [stat_props, datetime(2019, 1, 7, 0, 0), 'SNDP', 4.7, True],
        [stat_props, datetime(2019, 1, 9, 0, 0), 'Tmedia', 28.1, True],
        [stat_props, datetime(2019, 1, 9, 0, 0), 'DEWP', 24.0, True],
        [stat_props, datetime(2019, 1, 9, 0, 0), 'P', None, True],
        [stat_props, datetime(2019, 1, 9, 0, 0), 'STP', 848.0, True],
        [stat_props, datetime(2019, 1, 9, 0, 0), 'VISIB', 3.5, True],
        [stat_props, datetime(2019, 1, 9, 0, 0), 'FF', 5.7, True],
        [stat_props, datetime(2019, 1, 9, 0, 0), 'MXSPD', 8.0, True],
        [stat_props, datetime(2019, 1, 9, 0, 0), 'GUST', None, True],
        [stat_props, datetime(2019, 1, 9, 0, 0), 'Tmax', 35.2, True],
        [stat_props, datetime(2019, 1, 9, 0, 0), 'Tmin', 21.6, True],
        [stat_props, datetime(2019, 1, 9, 0, 0), 'PREC', 0.12, True],
        [stat_props, datetime(2019, 1, 9, 0, 0), 'SNDP', 5.9, True]
    ]
    assert data_parsed == expected_data_parsed
    # global error
    filepath = str(tmpdir.join('report.txt'))
    err_msgs, _ = process.parse_and_check(
        filepath, parameters_filepath, limiting_params)
    assert err_msgs == [(0, 'the file has unknown format')]

    # --- RMN format ---
    filepath = join(TEST_DATA_PATH, 'rmn', 'ancona_right.csv')
    parameters_filepath = join(TEST_DATA_PATH, 'rmn', 'rmn_params.csv')
    limiting_params = {'Tmedia': ('FF', 'UR media')}
    err_msgs, data_parsed = process.parse_and_check(
        filepath, parameters_filepath, limiting_params)
    assert not err_msgs
    stat_props = {'cod_utente': 'ANCONA'}
    expected_data_parsed = [
        [stat_props, datetime(2018, 1, 1, 0, 0), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 0, 0), 'FF', 1.9, True],
        [stat_props, datetime(2018, 1, 1, 0, 0), 'Tmedia', 7.2, True],
        [stat_props, datetime(2018, 1, 1, 0, 0), 'P', 1018.1, True],
        [stat_props, datetime(2018, 1, 1, 0, 0), 'UR media', 63.0, True],
        [stat_props, datetime(2018, 1, 1, 0, 10), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 0, 10), 'FF', 2.6, True],
        [stat_props, datetime(2018, 1, 1, 0, 10), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 10), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 10), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 20), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 0, 20), 'FF', 1.6, True],
        [stat_props, datetime(2018, 1, 1, 0, 20), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 20), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 20), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 30), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 0, 30), 'FF', 0.6, True],
        [stat_props, datetime(2018, 1, 1, 0, 30), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 30), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 30), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 40), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 0, 40), 'FF', 0.5, True],
        [stat_props, datetime(2018, 1, 1, 0, 40), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 40), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 40), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 50), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 0, 50), 'FF', 0.8, True],
        [stat_props, datetime(2018, 1, 1, 0, 50), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 50), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 50), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 0), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 1, 0), 'FF', 1.0, True],
        [stat_props, datetime(2018, 1, 1, 1, 0), 'Tmedia', 8.0, True],
        [stat_props, datetime(2018, 1, 1, 1, 0), 'P', 1017.6, True],
        [stat_props, datetime(2018, 1, 1, 1, 0), 'UR media', 60.0, True],
        [stat_props, datetime(2018, 1, 1, 1, 10), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 1, 10), 'FF', 1.6, True],
        [stat_props, datetime(2018, 1, 1, 1, 10), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 10), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 10), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 20), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 1, 20), 'FF', 1.4, True],
        [stat_props, datetime(2018, 1, 1, 1, 20), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 20), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 20), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 30), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 1, 30), 'FF', 3.6, True],
        [stat_props, datetime(2018, 1, 1, 1, 30), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 30), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 30), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 40), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 1, 40), 'FF', 2.3, True],
        [stat_props, datetime(2018, 1, 1, 1, 40), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 40), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 40), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 50), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 1, 50), 'FF', 3.7, True],
        [stat_props, datetime(2018, 1, 1, 1, 50), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 50), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 50), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 0), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 0), 'FF', 4.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 0), 'Tmedia', 9.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 0), 'P', 1016.9, True],
        [stat_props, datetime(2018, 1, 1, 2, 0), 'UR media', 58.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 10), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 10), 'FF', 3.7, True],
        [stat_props, datetime(2018, 1, 1, 2, 10), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 10), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 10), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 20), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 20), 'FF', 3.7, True],
        [stat_props, datetime(2018, 1, 1, 2, 20), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 20), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 20), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 30), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 30), 'FF', 3.9, True],
        [stat_props, datetime(2018, 1, 1, 2, 30), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 30), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 30), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 40), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 40), 'FF', 4.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 40), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 40), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 40), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 50), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 50), 'FF', 4.1, True],
        [stat_props, datetime(2018, 1, 1, 2, 50), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 50), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 50), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 0), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 3, 0), 'FF', 3.9, True],
        [stat_props, datetime(2018, 1, 1, 3, 0), 'Tmedia', 8.7, True],
        [stat_props, datetime(2018, 1, 1, 3, 0), 'P', 1016.2, True],
        [stat_props, datetime(2018, 1, 1, 3, 0), 'UR media', 59.0, True],
        [stat_props, datetime(2018, 1, 1, 3, 10), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 3, 10), 'FF', 4.0, True],
        [stat_props, datetime(2018, 1, 1, 3, 10), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 10), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 10), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 20), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 3, 20), 'FF', 4.4, True],
        [stat_props, datetime(2018, 1, 1, 3, 20), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 20), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 20), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 30), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 3, 30), 'FF', 4.2, True],
        [stat_props, datetime(2018, 1, 1, 3, 30), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 30), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 30), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 40), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 3, 40), 'FF', 4.1, True],
        [stat_props, datetime(2018, 1, 1, 3, 40), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 40), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 40), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 50), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 3, 50), 'FF', 4.0, True],
        [stat_props, datetime(2018, 1, 1, 3, 50), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 50), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 50), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 0), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 4, 0), 'FF', 4.5, True],
        [stat_props, datetime(2018, 1, 1, 4, 0), 'Tmedia', 10.1, True],
        [stat_props, datetime(2018, 1, 1, 4, 0), 'P', 1015.2, True],
        [stat_props, datetime(2018, 1, 1, 4, 0), 'UR media', 59.0, True],
        [stat_props, datetime(2018, 1, 1, 4, 10), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 4, 10), 'FF', 4.6, True],
        [stat_props, datetime(2018, 1, 1, 4, 10), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 10), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 10), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 20), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 4, 20), 'FF', 4.6, True],
        [stat_props, datetime(2018, 1, 1, 4, 20), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 20), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 20), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 30), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 4, 30), 'FF', 5.4, True],
        [stat_props, datetime(2018, 1, 1, 4, 30), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 30), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 30), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 40), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 4, 40), 'FF', 5.5, True],
        [stat_props, datetime(2018, 1, 1, 4, 40), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 40), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 40), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 50), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 4, 50), 'FF', 5.4, True],
        [stat_props, datetime(2018, 1, 1, 4, 50), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 50), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 50), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 0), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 5, 0), 'FF', 5.8, True],
        [stat_props, datetime(2018, 1, 1, 5, 0), 'Tmedia', 9.7, True],
        [stat_props, datetime(2018, 1, 1, 5, 0), 'P', 1014.3, True],
        [stat_props, datetime(2018, 1, 1, 5, 0), 'UR media', 62.0, True],
        [stat_props, datetime(2018, 1, 1, 5, 10), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 5, 10), 'FF', 5.3, True],
        [stat_props, datetime(2018, 1, 1, 5, 10), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 10), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 10), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 20), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 5, 20), 'FF', 5.3, True],
        [stat_props, datetime(2018, 1, 1, 5, 20), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 20), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 20), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 30), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 5, 30), 'FF', 5.0, True],
        [stat_props, datetime(2018, 1, 1, 5, 30), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 30), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 30), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 40), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 5, 40), 'FF', 5.3, True],
        [stat_props, datetime(2018, 1, 1, 5, 40), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 40), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 40), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 50), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 5, 50), 'FF', 4.5, True],
        [stat_props, datetime(2018, 1, 1, 5, 50), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 50), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 50), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 6, 0), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 6, 0), 'FF', 4.6, True],
        [stat_props, datetime(2018, 1, 1, 6, 0), 'Tmedia', 9.5, True],
        [stat_props, datetime(2018, 1, 1, 6, 0), 'P', 1014.1, True],
        [stat_props, datetime(2018, 1, 1, 6, 0), 'UR media', 64.0, True]
    ]
    assert data_parsed == expected_data_parsed
    # global error
    filepath = str(tmpdir.join('report.txt'))
    with open(filepath, 'w'):
        pass
    err_msgs, _ = process.parse_and_check(
        filepath, parameters_filepath, limiting_params)
    assert err_msgs == [(0, 'the file has unknown format')]
    # various errors
    limiting_params = {'Tmedia': ('UR media', 'DD')}
    filepath = join(TEST_DATA_PATH, 'rmn', 'ancona_wrong5.csv')
    parameters_filepath = join(TEST_DATA_PATH, 'rmn', 'rmn_params.csv')
    err_msgs, data_parsed = process.parse_and_check(
        filepath, parameters_filepath, limiting_params)
    assert err_msgs == [
        (10, 'the row is not strictly after the previous'),
        (4, "The value of 'DD' is out of range [0.0, 360.0]"),
        (4, "The values of 'Tmedia' and 'UR media' are not consistent"),
        (5, "The value of 'FF' is out of range [0.0, 102.0]"),
        (6, "The value of 'Tmedia' is out of range [-35.0, 45.0]"),
        (16, "The values of 'Tmedia' and 'UR media' are not consistent"),
        (22, "The values of 'Tmedia' and 'UR media' are not consistent"),
        (28, "The values of 'Tmedia' and 'UR media' are not consistent"),
        (34, "The values of 'Tmedia' and 'UR media' are not consistent"),
        (40, "The values of 'Tmedia' and 'UR media' are not consistent")
    ]
    assert data_parsed == [
        [stat_props, datetime(2018, 1, 1, 0, 0), 'DD', 361.0, False],
        [stat_props, datetime(2018, 1, 1, 0, 0), 'FF', 1.9, True],
        [stat_props, datetime(2018, 1, 1, 0, 0), 'Tmedia', 7.2, False],
        [stat_props, datetime(2018, 1, 1, 0, 0), 'P', 1018.1, True],
        [stat_props, datetime(2018, 1, 1, 0, 0), 'UR media', 63.0, True],
        [stat_props, datetime(2018, 1, 1, 0, 10), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 0, 10), 'FF', -1.6, False],
        [stat_props, datetime(2018, 1, 1, 0, 10), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 10), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 10), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 20), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 0, 20), 'FF', 1.6, True],
        [stat_props, datetime(2018, 1, 1, 0, 20), 'Tmedia', 47.0, False],
        [stat_props, datetime(2018, 1, 1, 0, 20), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 20), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 30), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 0, 30), 'FF', 0.6, True],
        [stat_props, datetime(2018, 1, 1, 0, 30), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 30), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 30), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 40), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 0, 40), 'FF', 0.5, True],
        [stat_props, datetime(2018, 1, 1, 0, 40), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 40), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 40), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 50), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 0, 50), 'FF', 0.8, True],
        [stat_props, datetime(2018, 1, 1, 0, 50), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 50), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 0, 50), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 10), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 1, 10), 'FF', 1.6, True],
        [stat_props, datetime(2018, 1, 1, 1, 10), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 10), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 10), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 20), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 1, 20), 'FF', 1.4, True],
        [stat_props, datetime(2018, 1, 1, 1, 20), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 20), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 20), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 30), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 1, 30), 'FF', 3.6, True],
        [stat_props, datetime(2018, 1, 1, 1, 30), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 30), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 30), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 40), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 1, 40), 'FF', 2.3, True],
        [stat_props, datetime(2018, 1, 1, 1, 40), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 40), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 40), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 50), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 1, 50), 'FF', 3.7, True],
        [stat_props, datetime(2018, 1, 1, 1, 50), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 50), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 1, 50), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 0), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 0), 'FF', 4.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 0), 'Tmedia', 9.0, False],
        [stat_props, datetime(2018, 1, 1, 2, 0), 'P', 1016.9, True],
        [stat_props, datetime(2018, 1, 1, 2, 0), 'UR media', 58.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 10), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 10), 'FF', 3.7, True],
        [stat_props, datetime(2018, 1, 1, 2, 10), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 10), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 10), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 20), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 20), 'FF', 3.7, True],
        [stat_props, datetime(2018, 1, 1, 2, 20), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 20), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 20), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 30), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 30), 'FF', 3.9, True],
        [stat_props, datetime(2018, 1, 1, 2, 30), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 30), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 30), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 40), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 40), 'FF', 4.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 40), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 40), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 40), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 50), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 2, 50), 'FF', 4.1, True],
        [stat_props, datetime(2018, 1, 1, 2, 50), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 50), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 2, 50), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 0), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 3, 0), 'FF', 3.9, True],
        [stat_props, datetime(2018, 1, 1, 3, 0), 'Tmedia', 8.7, False],
        [stat_props, datetime(2018, 1, 1, 3, 0), 'P', 1016.2, True],
        [stat_props, datetime(2018, 1, 1, 3, 0), 'UR media', 59.0, True],
        [stat_props, datetime(2018, 1, 1, 3, 10), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 3, 10), 'FF', 4.0, True],
        [stat_props, datetime(2018, 1, 1, 3, 10), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 10), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 10), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 20), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 3, 20), 'FF', 4.4, True],
        [stat_props, datetime(2018, 1, 1, 3, 20), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 20), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 20), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 30), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 3, 30), 'FF', 4.2, True],
        [stat_props, datetime(2018, 1, 1, 3, 30), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 30), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 30), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 40), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 3, 40), 'FF', 4.1, True],
        [stat_props, datetime(2018, 1, 1, 3, 40), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 40), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 40), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 50), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 3, 50), 'FF', 4.0, True],
        [stat_props, datetime(2018, 1, 1, 3, 50), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 50), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 3, 50), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 0), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 4, 0), 'FF', 4.5, True],
        [stat_props, datetime(2018, 1, 1, 4, 0), 'Tmedia', 10.1, False],
        [stat_props, datetime(2018, 1, 1, 4, 0), 'P', 1015.2, True],
        [stat_props, datetime(2018, 1, 1, 4, 0), 'UR media', 59.0, True],
        [stat_props, datetime(2018, 1, 1, 4, 10), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 4, 10), 'FF', 4.6, True],
        [stat_props, datetime(2018, 1, 1, 4, 10), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 10), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 10), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 20), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 4, 20), 'FF', 4.6, True],
        [stat_props, datetime(2018, 1, 1, 4, 20), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 20), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 20), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 30), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 4, 30), 'FF', 5.4, True],
        [stat_props, datetime(2018, 1, 1, 4, 30), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 30), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 30), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 40), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 4, 40), 'FF', 5.5, True],
        [stat_props, datetime(2018, 1, 1, 4, 40), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 40), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 40), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 50), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 4, 50), 'FF', 5.4, True],
        [stat_props, datetime(2018, 1, 1, 4, 50), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 50), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 4, 50), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 0), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 5, 0), 'FF', 5.8, True],
        [stat_props, datetime(2018, 1, 1, 5, 0), 'Tmedia', 9.7, False],
        [stat_props, datetime(2018, 1, 1, 5, 0), 'P', 1014.3, True],
        [stat_props, datetime(2018, 1, 1, 5, 0), 'UR media', 62.0, True],
        [stat_props, datetime(2018, 1, 1, 5, 10), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 5, 10), 'FF', 5.3, True],
        [stat_props, datetime(2018, 1, 1, 5, 10), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 10), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 10), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 20), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 5, 20), 'FF', 5.3, True],
        [stat_props, datetime(2018, 1, 1, 5, 20), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 20), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 20), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 30), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 5, 30), 'FF', 5.0, True],
        [stat_props, datetime(2018, 1, 1, 5, 30), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 30), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 30), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 40), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 5, 40), 'FF', 5.3, True],
        [stat_props, datetime(2018, 1, 1, 5, 40), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 40), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 40), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 50), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 5, 50), 'FF', 4.5, True],
        [stat_props, datetime(2018, 1, 1, 5, 50), 'Tmedia', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 50), 'P', None, True],
        [stat_props, datetime(2018, 1, 1, 5, 50), 'UR media', None, True],
        [stat_props, datetime(2018, 1, 1, 6, 0), 'DD', 180.0, True],
        [stat_props, datetime(2018, 1, 1, 6, 0), 'FF', 4.6, True],
        [stat_props, datetime(2018, 1, 1, 6, 0), 'Tmedia', 9.5, False],
        [stat_props, datetime(2018, 1, 1, 6, 0), 'P', 1014.1, True],
        [stat_props, datetime(2018, 1, 1, 6, 0), 'UR media', 64.0, True]
    ]

    # --- trentino format ---
    parameters_filepath = join(TEST_DATA_PATH, 'trentino', 'trentino_params.csv')
    filepath = join(TEST_DATA_PATH, 'trentino', 'T0001.csv')
    stat_props = {'cod_utente': '0001', 'desc': 'Pergine Valsugana (Convento)',
                  'height': 475.0, 'lat': 46.06227631, 'lon': 11.23670156}
    expected_data = [
        [stat_props, datetime(1930, 5, 1, 9, 0), 'Tmin', 10.0, True],
        [stat_props, datetime(1930, 5, 2, 9, 0), 'Tmin', 11.0, True],
        [stat_props, datetime(1930, 5, 3, 9, 0), 'Tmin', 10.0, True],
        [stat_props, datetime(1930, 5, 4, 9, 0), 'Tmin', 8.0, True],
        [stat_props, datetime(1930, 5, 5, 9, 0), 'Tmin', 12.0, True],
        [stat_props, datetime(1930, 5, 6, 9, 0), 'Tmin', 8.0, True],
        [stat_props, datetime(1930, 5, 7, 9, 0), 'Tmin', 10.0, True],
        [stat_props, datetime(1930, 5, 8, 9, 0), 'Tmin', 7.0, True],
        [stat_props, datetime(1930, 5, 9, 9, 0), 'Tmin', 8.0, True],
        [stat_props, datetime(1930, 5, 10, 9, 0), 'Tmin', 7.0, True],
        [stat_props, datetime(1930, 5, 11, 9, 0), 'Tmin', 5.0, True],
        [stat_props, datetime(1930, 5, 12, 9, 0), 'Tmin', 7.0, True],
        [stat_props, datetime(1930, 5, 13, 9, 0), 'Tmin', None, True],
        [stat_props, datetime(1930, 5, 14, 9, 0), 'Tmin', 9.0, True]
    ]
    err_msgs, parsed_data = process.parse_and_check(filepath, parameters_filepath)
    assert not err_msgs
    assert parsed_data == expected_data
    # with some errors
    filepath = join(TEST_DATA_PATH, 'trentino', 'wrong3.csv')
    err_msgs, parsed_data = process.parse_and_check(filepath, parameters_filepath)
    assert err_msgs == [
        (5, 'the date format is wrong'),
        (6, 'the value for Tmin is not numeric'),
        (8, 'the row is not strictly after the previous'),
        (12, 'the row is duplicated with different values'),
        (13, 'the value for quality is missing'),
        (17, "The value of 'Tmin' is out of range [-40.0, 40.0]")]
    expected_data = [
        [stat_props, datetime(1930, 5, 3, 9, 0), 'Tmin', 10.0, True],
        [stat_props, datetime(1930, 5, 5, 9, 0), 'Tmin', 12.0, True],
        [stat_props, datetime(1930, 5, 5, 9, 0), 'Tmin', 12.0, True],
        [stat_props, datetime(1930, 5, 6, 9, 0), 'Tmin', 8.0, True],
        [stat_props, datetime(1930, 5, 8, 9, 0), 'Tmin', 7.0, True],
        [stat_props, datetime(1930, 5, 9, 9, 0), 'Tmin', 8.0, True],
        [stat_props, datetime(1930, 5, 10, 9, 0), 'Tmin', 7.0, True],
        [stat_props, datetime(1930, 5, 11, 9, 0), 'Tmin', 500.0, False],
        [stat_props, datetime(1930, 5, 12, 9, 0), 'Tmin', 7.0, True],
        [stat_props, datetime(1930, 5, 13, 9, 0), 'Tmin', None, True],
        [stat_props, datetime(1930, 5, 14, 9, 0), 'Tmin', 9.0, True]
    ]
    assert parsed_data == expected_data


def test_make_report(tmpdir):
    parameters_filepath = join(TEST_DATA_PATH, 'arpa19', 'arpa19_params.csv')
    # no errors
    in_filepath = join(TEST_DATA_PATH, 'arpa19', 'loc01_70001_201301010000_201401010100.dat')
    limiting_params = {'3': ('4', '5')}
    out_filepath = str(tmpdir.join('report.txt'))
    outdata_filepath = str(tmpdir.join('data.csv'))
    assert not exists(out_filepath)
    assert not exists(outdata_filepath)
    msgs, data_parsed = process.make_report(
        in_filepath, out_filepath, outdata_filepath, parameters_filepath=parameters_filepath,
        limiting_params=limiting_params)
    assert exists(out_filepath)
    assert exists(outdata_filepath)
    assert "No errors found" in msgs
    assert data_parsed == arpa19.parse(in_filepath, parameters_filepath)

    # some formatting errors
    in_filepath = join(TEST_DATA_PATH, 'arpa19', 'wrong_70001_201301010000_201401010100.dat')
    limiting_params = {'3': ('4', '5')}
    out_filepath = str(tmpdir.join('report2.txt'))
    outdata_filepath = str(tmpdir.join('data2.csv'))
    assert not exists(out_filepath)
    assert not exists(outdata_filepath)
    msgs, data_parsed = process.make_report(
        in_filepath, out_filepath, outdata_filepath, parameters_filepath=parameters_filepath,
        limiting_params=limiting_params)
    assert exists(out_filepath)
    assert exists(outdata_filepath)
    err_msgs = [
        "Row 2: The spacing in the row is wrong",
        'Row 3: the latitude changes',
        'Row 5: it is not strictly after the previous',
        'Row 21: duplication of rows with different data',
        'Row 22: the time is not coherent with the filename',
    ]
    for err_msg in err_msgs:
        assert err_msg in msgs
    assert data_parsed == process.parse_and_check(
        in_filepath, parameters_filepath, limiting_params)[1]

    # some errors
    in_filepath = join(TEST_DATA_PATH, 'arpa19', 'wrong_70002_201301010000_201401010100.dat')
    limiting_params = {'3': ('1', '2')}
    out_filepath = str(tmpdir.join('report3.txt'))
    outdata_filepath = str(tmpdir.join('data3.csv'))
    assert not exists(out_filepath)
    assert not exists(outdata_filepath)
    msgs, data_parsed = process.make_report(
        in_filepath, out_filepath, outdata_filepath, parameters_filepath=parameters_filepath,
        limiting_params=limiting_params)
    assert exists(out_filepath)
    assert exists(outdata_filepath)
    err_msgs = [
        "Row 1: The value of '1' is out of range [0.0, 1020.0]",
        "Row 2: The value of '2' is out of range [0.0, 360.0]",
        "Row 3: The value of '3' is out of range [-350.0, 450.0]",
        "Row 5: The values of '3' and '2' are not consistent",
        "Row 6: The values of '3' and '2' are not consistent",
        "Row 7: The values of '3' and '2' are not consistent",
        "Row 10: The values of '3' and '2' are not consistent",
        "Row 20: The values of '3' and '2' are not consistent"
    ]
    for err_msg in err_msgs:
        assert err_msg in msgs
    assert data_parsed == process.parse_and_check(
        in_filepath, parameters_filepath, limiting_params)[1]
